---
description: CI/テストで品質を担保するための判断基準と、失敗時の切り分け手順。
globs:
  - ".github/workflows/**/*"
  - "**/*.{test,spec}.{ts,tsx,js,jsx,py}"
  - "**/playwright.config.*"
  - "**/vitest.config.*"
  - "**/jest.config.*"
  - "**/pytest.ini"
  - "**/pyproject.toml"
  - "**/requirements*.txt"
alwaysApply: false
---

# 品質: CI/テスト（Auto Attached）

## 変更とテストの最低基準

- **バグ修正**: 可能なら「再現テスト」を先に追加し、修正で通す（回帰防止）
- **仕様追加/変更**: 正常系 + 代表的な異常系（境界値・権限・例外）を入れる
- **リファクタ**: 契約が変わらないことをテストで担保（壊れたら直すのはテスト）

## テストの粒度（優先順）

- まずユニット/統合で**契約（入出力）**を固定
- E2Eは「最重要フロー」のみ（フレークを増やさない）

## CIが落ちたとき（順序）

- まず**同等のコマンドで再現**（ローカル/CI差分は後で潰す）
- 失敗は「環境差」か「契約破壊」かを分ける（Node/OS/ENV、時刻、並列、依存更新）
- “通すだけ”の緩和（skip/雑なタイムアウト増加）は最終手段。根本原因を残す

## PR/作業説明に含めるもの（短く）

- **テスト計画**（何をどう確認したか / 何が未確認か）
