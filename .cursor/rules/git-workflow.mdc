---
description: Gitワークフロー改善ルール。コミット・プッシュの精度を維持するための手順。
alwaysApply: false
---

# Gitワークフロー改善ルール

## 基本原則

**コミット・プッシュの精度を維持するため、以下の手順を必ず実行する。**

**関連ルール**: `.cursor/rules/system-stability.mdc`（既存システム保護ルール）と連携して動作します。

## コミット前の確認手順

以下の手順は、基本原則を実現するための具体的なアクションです。コミット・プッシュ前に必ず実行してください。

### 1. 変更ファイルの確認

```bash
# 変更ファイルを確認
git status

# 変更内容を確認（必要に応じて）
git diff
```

### 2. 変更のグループ化

関連する変更をグループ化してコミットする：

- **機能追加**: 新機能に関連する全てのファイル（コード、テスト、ドキュメント）
- **バグ修正**: バグ修正に関連する全てのファイル
- **ドキュメント更新**: ドキュメントのみの変更
- **リファクタリング**: コード構造の改善のみ
- **リンター/フォーマット**: コードスタイルの修正のみ

### 3. コミットメッセージの規則

- **プレフィックス**: `feat:`, `fix:`, `docs:`, `chore:`, `refactor:` など
- **簡潔な説明**: 何を変更したかを1行で説明
- **詳細**: 必要に応じて本文に詳細を記載

**例**:
```
feat: サイネージデザイン改善（余白削減・タイトル1行化）
docs: KB-097（Pi3デプロイ時のsystemctl mask必要性）をドキュメントに反映
fix: サイネージレンダラーのリンターエラー修正
chore: import順序修正と微細なフォーマット調整
```

## コミット実行手順

### 1. ステージング

```bash
# 関連するファイルのみをステージング
git add <file1> <file2> ...

# または、パターンで指定
git add apps/api/src/**/*.ts
git add docs/**/*.md
```

### 2. コミット

```bash
# コミットメッセージを指定
git commit -m "feat: 機能説明"

# または、エディタで編集
git commit
```

### 3. プッシュ前の確認

```bash
# コミット履歴を確認
git log --oneline -5

# リモートとの差分を確認
git diff HEAD origin/main

# ステータスを確認
git status
```

### 4. プッシュ

```bash
# プッシュ実行
git push origin main
```

## よくある問題と対策

### 問題1: 複数の変更が混在している

**対策**: `git add -p` でインタラクティブにステージング

```bash
# 変更を部分的にステージング
git add -p <file>
```

### 問題2: コミット後に変更を追加したい

**対策**: `git commit --amend` で直前のコミットを修正

```bash
# 変更を追加してステージング
git add <file>

# 直前のコミットに追加
git commit --amend --no-edit
```

### 問題3: 誤って全てのファイルをステージングした

**対策**: `git reset HEAD` でステージングを解除

```bash
# 全てのステージングを解除
git reset HEAD

# 特定のファイルのみ解除
git reset HEAD <file>
```

## チェックリスト

コミット・プッシュ前に以下を確認：

- [ ] `git status`で変更ファイルを確認したか？
- [ ] 関連する変更をグループ化したか？
- [ ] コミットメッセージが明確か？
- [ ] リンターチェックが通るか？（`pnpm lint`）
- [ ] プッシュ前に`git log`でコミット履歴を確認したか？
- [ ] 未コミットの変更が残っていないか？（`git status`）

## 関連ドキュメント

- [Git公式ドキュメント](https://git-scm.com/doc)
- [Conventional Commits](https://www.conventionalcommits.org/)
- `.cursor/rules/system-stability.mdc`: 既存システム保護ルール（コミット前の影響範囲確認）
- `.cursor/rules/documentation-first.mdc`: ドキュメント優先ルール（コミット前のドキュメント確認）
