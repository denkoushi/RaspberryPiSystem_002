---
description: ドキュメントメンテナンスと肥大化対策のルール。大規模ファイルの分割と管理方針。
alwaysApply: false
---

# ドキュメントメンテナンスルール

## 基本原則

**ドキュメントファイルが肥大化した場合は、機能別に分割して管理性を維持する。エディタのクラッシュやパフォーマンス低下を防ぐため、ファイルサイズを適切な範囲に保つ。**

## ファイルサイズの目安

### 推奨サイズ

- **推奨**: 各ファイル300-700行程度
- **警告**: 1,000行を超える場合は分割を検討
- **必須分割**: 3,000行を超える場合は分割を実施

### 分割基準

以下の条件を満たす場合は分割を検討：

1. **ファイルサイズ**: 3,000行を超える
2. **編集時の問題**: エディタのクラッシュやパフォーマンス低下が発生
3. **検索性の低下**: 特定のKBを探すのが困難
4. **カテゴリの明確化**: 機能別に明確に分類できる

## 分割手順

### 1. 分割前の準備

1. **バックアップ**: 元のファイルをGitでコミット（分割前の状態を保存）
2. **分類の決定**: KBを機能別に分類（例: Docker/Caddy、バックアップ、Ansibleなど）
3. **索引ファイルの作成**: 元のファイルを索引ファイルに変更

### 2. 分割の実施

1. **サブディレクトリの作成**: `docs/knowledge-base/<category>/`ディレクトリを作成
2. **サブカテゴリファイルの作成**: 各カテゴリごとにファイルを作成
3. **KBの移動**: 各KBセクションを適切なサブカテゴリファイルに移動
4. **索引ファイルの更新**: 元のファイルを索引ファイルに変更し、各サブカテゴリへのリンクを追加

### 3. 分割後の確認

1. **リンクの更新**: `index.md`や他のドキュメント内の参照を更新
2. **ルールファイルの更新**: `.cursor/rules/`内の参照を更新
3. **動作確認**: すべてのリンクが正しく動作することを確認

## 分割例

### 実施例: infrastructure.mdの分割（2025-12-29）

**分割前**:
- `infrastructure.md`: 3,217行（67件のKB）

**分割後**:
- `infrastructure.md`: 61行（索引ファイル）
- `infrastructure/docker-caddy.md`: 312行（8件）
- `infrastructure/backup-restore.md`: 606行（10件）
- `infrastructure/ansible-deployment.md`: 559行（7件）
- `infrastructure/security.md`: 338行（8件）
- `infrastructure/signage.md`: 469行（10件）
- `infrastructure/hardware-nfc.md`: 155行（3件）
- `infrastructure/miscellaneous.md`: 704行（16件）

**効果**:
- 最大ファイルサイズ: 704行（元の22%）
- エディタのクラッシュリスクを大幅に削減
- 検索性の向上

## チェックリスト

分割実施前に以下を確認：

- [ ] 元のファイルをGitでコミットしたか？
- [ ] KBの分類が明確か？
- [ ] サブカテゴリの命名が適切か？
- [ ] 索引ファイルに各サブカテゴリへのリンクを追加したか？
- [ ] `index.md`のリンクを更新したか？
- [ ] `.cursor/rules/`内の参照を更新したか？
- [ ] 他のドキュメント内の参照を更新したか？

## 関連ドキュメント

- `docs/knowledge-base/infrastructure.md`: 分割実施例
- `docs/knowledge-base/index.md`: ナレッジベース索引
- `.cursor/rules/documentation-first.mdc`: ドキュメント優先ルール
- `.cursor/rules/system-stability.mdc`: 既存システム保護ルール
