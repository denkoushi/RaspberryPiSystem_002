# Pi3/Pi4のセキュリティ保護について

最終更新: 2025-12-14

## 質問

**Pi3、Pi4はローカルネットワーク、インターネット、いずれの環境でも今回のセキュリティ機能にて保護されるのか？Pi5が堅強だから守られるのか？**

## 回答

### 結論

**Pi3/Pi4は、Pi5（サーバー）のセキュリティ機能によって間接的に保護されますが、直接的な保護は限定的です。**

### 詳細説明

#### 1. アーキテクチャ上の保護

**Pi5（サーバー）がすべてのリクエストを処理**:
- Pi3/Pi4は**クライアント端末**として動作し、Pi5のAPIサーバーに接続します
- Pi3/Pi4からPi5への通信は、Pi5側のセキュリティ機能（HTTPS、レート制限、認証・認可）によって保護されます
- **Pi5が堅強であることで、Pi3/Pi4からの通信が保護されます**

**保護される通信**:
- ✅ Pi4キオスク → Pi5 API（HTTPS、レート制限、認証・認可）
- ✅ Pi3サイネージ → Pi5 API（HTTPS、レート制限）
- ✅ 管理コンソール（Pi5）へのアクセス（IP制限、MFA、セキュリティヘッダー）

#### 2. Pi3/Pi4自体の保護

**Pi3/Pi4はローカルネットワーク内でのみ動作**:
- Pi3/Pi4は**インターネットに直接接続しません**
- ローカルネットワーク（192.168.10.0/24）内でのみ動作します
- インターネット経由の攻撃は**Pi5を経由しないと到達できません**

**Pi3/Pi4のセキュリティ対策**:

| 対策 | Pi3 | Pi4 | Pi5 |
|------|-----|-----|-----|
| **ファイアウォール（ufw）** | ❌ 不要（ローカルのみ） | ❌ 不要（ローカルのみ） | ✅ 実装済み |
| **HTTPS強制** | ❌ 不要（Pi5側で対応） | ❌ 不要（Pi5側で対応） | ✅ 実装済み |
| **fail2ban** | ❌ 不要（SSH接続なし） | ❌ 不要（SSH接続なし） | ✅ 実装済み |
| **ClamAV** | ❌ 不要（リソース不足） | ✅ 軽量設定（週次スキャン） | ✅ フル設定（日次スキャン） |
| **Trivy** | ❌ 不要（リソース不足） | ❌ 不要 | ✅ 実装済み |
| **rkhunter** | ❌ 不要（リソース不足） | ✅ 実装済み | ✅ 実装済み |
| **リアルタイム監視** | ❌ 不要（Pi5側で監視） | ❌ 不要（Pi5側で監視） | ✅ 実装済み |
| **MFA** | ❌ 不要（管理画面なし） | ❌ 不要（管理画面なし） | ✅ 実装済み |

#### 3. 保護の仕組み

**多層防御のアーキテクチャ**:

```
インターネット
    ↓
[Pi5: ファイアウォール（ufw）]
    ↓
[Pi5: HTTPS強制（Caddy）]
    ↓
[Pi5: レート制限（Fastify）]
    ↓
[Pi5: 認証・認可（JWT/MFA）]
    ↓
[Pi5: APIサーバー]
    ↓
ローカルネットワーク（192.168.10.0/24）
    ↓
[Pi3/Pi4: クライアント端末]
```

**保護されるポイント**:
1. **インターネット → Pi5**: ファイアウォール、HTTPS、レート制限、認証・認可で保護
2. **Pi5 → Pi3/Pi4**: ローカルネットワーク内の通信（外部から直接アクセス不可）
3. **Pi3/Pi4 → Pi5**: HTTPS、認証・認可で保護

#### 4. リスク評価

**Pi3/Pi4が直面するリスク**:

| リスク | 影響 | 対策 |
|--------|------|------|
| **ローカルネットワーク内の攻撃** | 中 | Pi5のセキュリティ機能で保護（HTTPS、認証・認可） |
| **Pi3/Pi4自体への直接攻撃** | 低 | ローカルネットワーク内のみで動作、インターネットに直接接続しない |
| **マルウェア感染** | 中 | Pi4は軽量ClamAV/rkhunterで保護、Pi3はリソース不足のためPi5側で監視 |
| **データ漏洩** | 低 | Pi3/Pi4はデータを保存せず、Pi5のデータベースに依存 |

**Pi5が堅強であることで守られる理由**:
- Pi3/Pi4は**Pi5のAPIサーバーに依存**しているため、Pi5が堅強であれば、Pi3/Pi4への攻撃もPi5を経由する必要があります
- Pi5のセキュリティ機能（HTTPS、認証・認可、レート制限）が、Pi3/Pi4への攻撃をブロックします

#### 5. 推奨事項

**現状の保護レベル**: ✅ **十分**

**理由**:
1. Pi3/Pi4はローカルネットワーク内でのみ動作し、インターネットに直接接続しない
2. Pi5のセキュリティ機能が、Pi3/Pi4への通信を保護している
3. Pi4には軽量なマルウェア対策（ClamAV/rkhunter）を実装済み
4. Pi3はリソース不足のため、セキュリティソフトの導入を見送っているが、Pi5側で監視可能

**追加の保護が必要な場合**:
- Pi3/Pi4への直接攻撃が懸念される場合: Pi3/Pi4にもufwを導入（通常は不要）
- マルウェア感染が懸念される場合: Pi3にも軽量ClamAVを導入（リソース不足のため推奨しない）

## まとめ

**Pi3/Pi4は、Pi5（サーバー）のセキュリティ機能によって間接的に保護されています。**

- ✅ **ローカルネットワーク環境**: Pi5のセキュリティ機能で保護
- ✅ **インターネット環境**: Pi5が堅強であることで、Pi3/Pi4への攻撃もPi5を経由する必要があり、Pi5のセキュリティ機能でブロックされます
- ✅ **Pi5が堅強だから守られる**: はい、その通りです。Pi3/Pi4はPi5のAPIサーバーに依存しているため、Pi5が堅強であれば、Pi3/Pi4も保護されます

**ただし、Pi3/Pi4自体への直接攻撃（ローカルネットワーク内からの攻撃）に対しては、Pi5のセキュリティ機能だけでは完全には保護できません。** しかし、ローカルネットワーク内での攻撃リスクは低く、現状の保護レベルで十分と判断しています。

## 関連ドキュメント

- [セキュリティ要件定義](./requirements.md)
- [Phase 9/10 詳細仕様書](./phase9-10-specifications.md)
- [システムアーキテクチャ概要](../architecture/overview.md)
