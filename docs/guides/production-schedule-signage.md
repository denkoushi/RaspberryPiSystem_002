---
title: 生産スケジュール進捗サイネージ可視化ガイド
tags: [サイネージ, 可視化, 生産スケジュール]
audience: [運用者, 開発者]
last-verified: 2026-02-06
category: guides
---

# 生産スケジュール進捗サイネージ可視化ガイド

検索登録された製番（FSEIBAN）に対して、完了/未完了の進捗をサイネージで遠距離視認できる形で表示するための設定手順です。

## 前提

- 検索登録製番（`KioskProductionScheduleSearchState.state.history`）に **FSEIBAN（8文字）** が保存されていること
- サイネージの可視化ダッシュボード機能が有効であること

## 可視化ダッシュボードの作成

管理コンソールの「可視化ダッシュボード」から以下の内容で作成します。

- **名前**: 任意（例: `生産スケジュール進捗`）
- **データソースタイプ**: `production_schedule`
- **レンダラータイプ**: `progress_list`
- **データソース設定（JSON）**: `{}`（現時点は空でOK）
- **レンダラー設定（JSON）**: `{}`（現時点は空でOK）
  - 未完部品名の表示を制御したい場合は、以下のキーを使用できます。
    - `maxIncompletePartsPerCard`（デフォルト: 6）
    - `showIncompleteParts`（デフォルト: true）
    - `incompleteLineStyle`（`bullets` | `comma`、デフォルト: `bullets`）
  - 例:
    ```json
    {
      "maxIncompletePartsPerCard": 6,
      "showIncompleteParts": true,
      "incompleteLineStyle": "bullets"
    }
    ```
- **有効**: ON

## サイネージスケジュールでの割り当て

管理コンソールの「サイネージ」→「スケジュール管理」で、スロットに可視化を割り当てます。

1. スケジュールを新規作成または編集
2. **新形式レイアウト**を使用
3. スロット（全体または左右）の **表示コンテンツ** を「可視化」に設定
4. 作成した「生産スケジュール進捗」ダッシュボードを選択
5. 保存

## 更新頻度について

- サイネージのレンダリングは既存のスケジューラで実行されます。
- 進捗データは **10分以内に反映**されるよう、データソース側で10分TTLキャッシュを採用しています。

## 表示される内容

- 上部: 総製番数 / 完了数 / 未完了数 / 進捗率
- 下部: 製番ごとのカード（FSEIBAN、完了/未完了、進捗%バー）
  - 未完部品名は **上位N件を表示し、残りは `+残りM件`** として表示されます

### 未完部品表示の詳細

未完部品名の表示は、以下のロジックで制御されます：

1. **データソース側の処理**:
   - 未完部品名を正規化（trim、重複除去、部品名昇順ソート）
   - `metadata`に構造化データ（`incompletePartsBySeiban`、`incompletePartsTotalBySeiban`）を追加
   - 保存上限は50件（`MAX_INCOMPLETE_PARTS_STORED`）

2. **レンダラー側の処理**:
   - 利用可能な高さに基づいて動的に行数を計算
   - `maxIncompletePartsPerCard`設定（デフォルト: 6）に従って表示件数を制御
   - 表示パターン:
     - 完了または未完部品なし: 「未完部品: なし」
     - 利用可能な高さが0行かつ未完部品あり: 「未完部品: +残りM件」
     - それ以外: 「未完部品:」+ 部品名リスト（`maxIncompletePartsPerCard`または利用可能行数まで）+ 残り件数（`remainingCount > 0`の場合）

3. **表示スタイル**:
   - `incompleteLineStyle`設定で変更可能:
     - `bullets`（デフォルト）: 箇条書き形式（`• 部品名1`）
     - `comma`: カンマ区切り形式（`部品名1, 部品名2`）

4. **テキストフィッティング**:
   - 全テキスト行が表示領域内に収まるように、`truncateToFit`で自動的に切り詰められます
   - 右端で切れることはありません

詳細は [knowledge-base/infrastructure/signage.md#kb-232](../knowledge-base/infrastructure/signage.md#kb-232-サイネージ未完部品表示ロジック改善表示制御正規化動的レイアウト) を参照してください。

## トラブルシュート

- **表示が更新されない**:
  - 検索登録製番（history）にFSEIBANが入っているか確認
  - サイネージ再レンダリング（管理コンソールの再レンダリングボタン）を実行
  - 10分以内の反映仕様のため、直後は反映されない場合があります
