# MFAセットアップ ステップバイステップガイド

最終更新: 2025-12-14

## ステップ1: 管理コンソールにログイン

1. **ブラウザで管理コンソールを開く**
   - URL: `https://100.106.158.2/admin`（Tailscale経由の場合）
   - または: `https://192.168.10.230/admin`（ローカルネットワーク経由の場合）

2. **ユーザー名とパスワードでログイン**
   - 通常通りログインしてください

**次のステップ**: ログインできたら「ステップ2」に進んでください。

---

## ステップ2: セキュリティページを開く

1. **左メニューから「セキュリティ」をクリック**
   - または、URLに直接アクセス: `https://100.106.158.2/admin/security`

2. **「MFAセットアップ」セクションを確認**
   - ページが表示されたら、次のステップに進んでください

**次のステップ**: セキュリティページが表示できたら「ステップ3」に進んでください。

---

## ステップ3: スマートフォンに認証アプリをインストール

1. **スマートフォンで認証アプリをインストール**
   - **推奨**: Google Authenticator（iOS/Android）
   - **代替**: Microsoft Authenticator（iOS/Android）
   - App StoreまたはGoogle Playで「Google Authenticator」を検索してインストール

2. **インストールが完了したら、次のステップに進んでください**

**次のステップ**: 認証アプリをインストールできたら「ステップ4」に進んでください。

---

## ステップ4: MFAセットアップ情報を生成

1. **セキュリティページで「セットアップ開始」ボタンをクリック**
   - 「MFAセットアップ」セクションにあるボタンをクリック

2. **QRコードが表示されることを確認**
   - QRコードと、シークレットキー（英数字の文字列）が表示されます
   - バックアップコード（10個）も表示されます

**次のステップ**: QRコードが表示されたら「ステップ5」に進んでください。

---

## ステップ5: QRコードをスキャン

1. **スマートフォンの認証アプリを開く**
   - Google Authenticatorを起動

2. **「+」ボタンまたは「アカウントを追加」をタップ**

3. **「QRコードをスキャン」を選択**

4. **管理コンソールに表示されているQRコードをスキャン**
   - スマートフォンのカメラでQRコードを読み取ります

5. **アカウントが追加されることを確認**
   - 「Factory Borrow System」などの名前でアカウントが追加されます
   - 6桁のコードが表示されます（30秒ごとに更新されます）

**次のステップ**: QRコードをスキャンして6桁のコードが表示されたら「ステップ6」に進んでください。

---

## ステップ6: コードを入力して有効化

1. **スマートフォンに表示されている6桁のコードを確認**
   - 例: `123456`（30秒ごとに更新されます）

2. **管理コンソールの「認証コード」入力欄に6桁のコードを入力**

3. **「有効化」ボタンをクリック**

4. **成功メッセージを確認**
   - 「MFAを有効化しました。バックアップコードを安全な場所に保管してください。」と表示されます

**次のステップ**: 有効化が成功したら「ステップ7」に進んでください。

---

## ステップ7: バックアップコードを保存

1. **表示されているバックアップコード（10個）をコピー**
   - 例: `ABCD-1234`, `EFGH-5678`, ...（10個）

2. **安全な場所に保存**
   - メモ帳アプリ、パスワードマネージャー、紙に書き留めるなど
   - **重要**: スマートフォンを紛失した場合、このコードでログインできます

3. **保存が完了したら、次のステップに進んでください**

**次のステップ**: バックアップコードを保存できたら「ステップ8」に進んでください。

---

## ステップ8: 動作確認（ログアウトして再ログイン）

1. **管理コンソールからログアウト**
   - 右上のユーザー名をクリック → 「ログアウト」

2. **再度ログイン**
   - ユーザー名とパスワードを入力

3. **MFAコードの入力画面が表示されることを確認**
   - 「認証コード」入力欄が表示されます

4. **スマートフォンの認証アプリで6桁のコードを確認して入力**

5. **「30日間記憶する」にチェックを入れる（推奨）**
   - チェックを入れると、30日間はコード入力が不要になります

6. **ログインボタンをクリック**

7. **ログインが成功することを確認**
   - 管理コンソールのトップページが表示されます

**完了**: MFAのセットアップが完了しました！

---

## トラブルシューティング

### QRコードが表示されない場合
- ページをリロードしてみてください
- ブラウザのJavaScriptが有効になっているか確認してください

### コードが一致しない場合
- スマートフォンの時刻が正しいか確認してください（自動設定を推奨）
- コードは30秒ごとに更新されるため、新しいコードを入力してください
- QRコードを再度スキャンしてみてください

### バックアップコードを紛失した場合
- MFAを無効化してから、再度セットアップしてください
- バックアップコードは再発行できません

### MFAを無効化したい場合
- セキュリティページの「MFA無効化」セクションで、パスワードを入力して無効化できます

---

## 実機セットアップ完了（2025-12-14）

✅ Microsoft Authenticatorを使用してMFAセットアップを完了
- QRコード表示機能は未実装のため、otpauth URLから手動で設定
- ログイン時のMFAコード入力が正常に動作することを確認
- バックアップコードも保存済み

## 次のステップ

MFAのセットアップが完了したら、Slack通知設定に進んでください。
[Slack通知設定ガイド](./slack-webhook-setup-step-by-step.md)を参照してください。

**注意**: Slack通知設定は、ワークスペース設定から直接Incoming Webhookを作成する方法が推奨されます（アプリ作成フローではボットユーザーの設定が必要な場合があります）。
