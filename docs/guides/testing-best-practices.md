---
title: テスト戦略とベストプラクティス
tags: [テスト, ベストプラクティス, CI/CD, 実機テスト]
audience: [開発者, テスター, プロジェクトマネージャー]
last-verified: 2025-11-27
related: [photo-loan-test-plan.md, ci-troubleshooting.md, verification-checklist.md]
category: guides
update-frequency: medium
---

# テスト戦略とベストプラクティス

## 概要

本ドキュメントでは、macテスト、CIテスト、実機テストの進め方について、ベストプラクティスを説明します。

## 現状の整理

### テスト計画表の状況

テスト計画表（`docs/guides/photo-loan-test-plan.md`）には**53件のテスト項目**が記載されていますが、これは**テスト計画**であり、**実装済みのテスト**ではありません。

### 実装済みテストの状況

- **統合テスト**: 3件（photo-borrow, photo-storage, clients）
- **単体テスト**: 0件
- **E2Eテスト**: 0件
- **実機テスト**: 未実施

### テスト計画表の✅マークの意味

テスト計画表の✅マークは「**テストケースが定義されている**」ことを示しており、「**テストが実装済み**」や「**テストが通過済み**」を意味するものではありません。

## ベストプラクティス

### 1. テストの3段階アプローチ

機能開発においては、以下の3段階でテストを進めるのがベストプラクティスです：

```
機能実装 → macテスト → CIテスト → 実機テスト
```

### 2. 部分機能ごとに進める（推奨）

**推奨アプローチ**: 部分機能ごとに、macテスト → CIテスト → 実機テストの順で進める

**理由**:
- **早期フィードバック**: 問題を早期に発見できる
- **リスクの最小化**: 小さな単位で検証することで、大きな問題を回避できる
- **効率的な開発**: 一度にすべてをテストするよりも、段階的に進める方が効率的

**例**: 写真撮影持出機能の場合

1. **部分機能1: バックエンドAPI**
   - macテスト: 統合テストを実装・実行
   - CIテスト: GitHub Actionsで自動実行
   - 実機テスト: Raspberry Pi 5でAPI動作確認

2. **部分機能2: フロントエンドUI**
   - macテスト: コンポーネントテスト、E2Eテストを実装・実行
   - CIテスト: GitHub Actionsで自動実行
   - 実機テスト: Raspberry Pi 4でUI動作確認

3. **部分機能3: 統合フロー**
   - macテスト: E2Eテストで全体フローを検証
   - CIテスト: GitHub Actionsで自動実行
   - 実機テスト: Raspberry Pi 5とRaspberry Pi 4で統合動作確認

### 3. テストの優先順位

すべてのテストを一度に実装するのではなく、**優先順位をつけて段階的に実装**します：

#### 優先度1: 必須テスト（実装必須）
- **統合テスト**: APIエンドポイントの動作確認
- **CIテスト**: 自動化されたテストで回帰を防ぐ
- **実機テスト（基本動作）**: 実際のハードウェアでの基本動作確認

#### 優先度2: 推奨テスト（実装推奨）
- **単体テスト**: 複雑なロジックの検証
- **E2Eテスト**: ユーザーシナリオの検証
- **実機テスト（詳細）**: エッジケースやパフォーマンスの確認

#### 優先度3: オプショナルテスト（実装任意）
- **パフォーマンステスト**: 負荷テスト、ストレステスト
- **セキュリティテスト**: 脆弱性スキャン
- **運用テスト**: 長期運用の検証

### 4. テスト実行のタイミング

#### macテスト
- **タイミング**: 機能実装直後、コミット前
- **目的**: ローカル環境での動作確認、早期のバグ発見
- **実行頻度**: 機能実装ごと、または1日1回以上

#### CIテスト
- **タイミング**: プッシュ時、プルリクエスト作成時
- **目的**: 自動化されたテストで回帰を防ぐ、コード品質の維持
- **実行頻度**: すべてのコミット

#### 実機テスト
- **タイミング**: CIテスト成功後、マージ前
- **目的**: 実際のハードウェア環境での動作確認
- **実行頻度**: 機能完成時、マージ前

### 5. テスト実装の段階的アプローチ

#### Phase 1: 基本機能のテスト（現在の状態）
- ✅ 統合テスト: APIエンドポイントの基本動作
- ⏳ 単体テスト: 複雑なロジックの検証（未実装）
- ⏳ E2Eテスト: ユーザーシナリオの検証（未実装）

#### Phase 2: 拡張テストの実装（次のステップ）
- 単体テストの実装（CameraService, PhotoStorageなど）
- E2Eテストの実装（Playwright）
- パフォーマンステストの実装

#### Phase 3: 実機テストの実施（マージ前）
- Raspberry Pi 5での動作確認
- Raspberry Pi 4での動作確認
- 統合動作確認

## 現在の写真撮影持出機能の状況

### 実装済み
- ✅ 機能実装（17件）
- ✅ 統合テスト（3件）
- ✅ CIテスト成功

### 未実装（テスト計画表に記載されているが未実装）
- ⏳ 単体テスト（CameraService, PhotoStorageなど）
- ⏳ E2Eテスト（Playwright）
- ⏳ パフォーマンステスト
- ⏳ 実機テスト

### 推奨される次のステップ

1. **実機テスト（基本動作）**: CIテスト成功後、マージ前に実施
   - Raspberry Pi 5でAPI動作確認
   - Raspberry Pi 4でUI動作確認
   - 基本的なフローが動作することを確認

2. **単体テスト・E2Eテスト**: 実機テスト成功後、必要に応じて実装
   - 複雑なロジックの検証が必要な場合
   - ユーザーシナリオの詳細な検証が必要な場合

3. **パフォーマンステスト**: 運用開始後、必要に応じて実装
   - 実際の負荷での動作確認が必要な場合

## よくある誤解

### 誤解1: テスト計画表の✅マーク = 実装済み
**正解**: ✅マークは「テストケースが定義されている」ことを示す。実装済みかどうかは別。

### 誤解2: すべてのテストを一度に実装する必要がある
**正解**: 優先順位をつけて段階的に実装する。基本機能のテストを先に実装し、拡張テストは必要に応じて追加する。

### 誤解3: macテスト、CIテスト、実機テストを同時に進める
**正解**: 部分機能ごとに、macテスト → CIテスト → 実機テストの順で進めるのが効率的。

## 関連ドキュメント

- [写真撮影持出機能 テスト計画](./photo-loan-test-plan.md): 詳細なテスト項目
- [CIテスト失敗のトラブルシューティング](./ci-troubleshooting.md): CIテストの問題解決
- [検証チェックリスト](./verification-checklist.md): 実機テストのチェックリスト
- [テストアーキテクチャ](../architecture/test-architecture.md): テスト設計の原則

