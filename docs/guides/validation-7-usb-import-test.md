# Validation 7: USB一括登録の実機検証手順

最終更新: 2025-11-24

## 検証概要

USBメモリからのCSVファイル一括登録機能の実機検証を実施します。

## CSVファイル形式

### 従業員CSV (`employees.csv`)

```csv
employeeCode,displayName,nfcTagUid,department,contact,status
EMP001,山田太郎,04C362E1330289,製造部,090-1234-5678,ACTIVE
EMP002,佐藤花子,04B34411340289,品質管理部,090-2345-6789,ACTIVE
```

**必須列**: `employeeCode`, `displayName`
**任意列**: `nfcTagUid`, `department`, `contact`, `status`

### アイテムCSV (`items.csv`)

```csv
itemCode,name,nfcTagUid,category,storageLocation,status,notes
ITEM001,ドライバーセット,04DE8366BC2A81,工具,工具庫A,ACTIVE,常用工具
ITEM002,メジャー,04C393C1330289,測定器具,工具庫B,ACTIVE,
```

**必須列**: `itemCode`, `name`
**任意列**: `nfcTagUid`, `category`, `storageLocation`, `status`, `notes`

## 検証手順

### ステップ1: CSVファイルの準備

1. **サンプルCSVファイルを作成**
   - `employees.csv` と `items.csv` を準備
   - UTF-8エンコーディングで保存
   - ヘッダー行を含める

2. **USBメモリにコピー**（実際のUSBメモリを使用する場合）
   - または、PCに直接コピーして使用

### ステップ2: 管理画面で一括登録ページにアクセス

1. **ブラウザで管理画面にログイン**
   ```
   http://<ラズパイ5のIP>:4173/login
   ```
   - ユーザー名: `admin`
   - パスワード: `admin1234`

2. **一括登録ページにアクセス**
   - ナビゲーションから「一括登録」を選択
   - または、直接 `http://<ラズパイ5のIP>:4173/admin/import` にアクセス

### ステップ3: CSVファイルをアップロード

1. **従業員CSVを選択**
   - 「従業員CSV（任意）」のファイル選択ボタンをクリック
   - `employees.csv` を選択

2. **アイテムCSVを選択**（オプション）
   - 「アイテムCSV（任意）」のファイル選択ボタンをクリック
   - `items.csv` を選択

3. **オプション設定**
   - 「既存データをクリアしてから取り込み」にチェックを入れるか選択
   - チェックを入れると、既存のデータを削除してから取り込みます

4. **取り込み開始**
   - 「取り込み開始」ボタンをクリック
   - 「アップロード中…」と表示されることを確認

### ステップ4: 取り込み結果を確認

1. **成功メッセージの確認**
   - 「最新ジョブ ID: ...」が表示されることを確認
   - サマリに取り込み結果が表示されることを確認
   - 例: `{"employees":{"created":2,"updated":0,"skipped":0}}`

2. **取込履歴の確認**
   - 「取込履歴」セクションにジョブが表示されることを確認
   - ステータスが「COMPLETED」であることを確認

### ステップ5: データが正しく登録されているか確認

1. **従業員一覧を確認**
   - ナビゲーションから「従業員管理」を選択
   - CSVで登録した従業員が表示されることを確認

2. **アイテム一覧を確認**
   - ナビゲーションから「アイテム管理」を選択
   - CSVで登録したアイテムが表示されることを確認

### ステップ6: エラーハンドリングの確認（オプション）

1. **不正なCSV形式のテスト**
   - ヘッダー行がないCSVをアップロード
   - 必須列が欠けているCSVをアップロード
   - エラーメッセージが表示されることを確認

2. **空のCSVのテスト**
   - 空のCSVファイルをアップロード
   - 適切なエラーメッセージが表示されることを確認

## 期待される結果

✅ **成功**:
- CSVファイルが正常にアップロードされる
- 取り込みが完了する
- データが正しく登録される
- 取込履歴にジョブが記録される

❌ **失敗**:
- アップロードが失敗する
- エラーメッセージが表示される
- データが登録されない

## トラブルシューティング

### CSVファイルがアップロードされない

- ファイルサイズを確認（大きすぎる場合は分割）
- CSVファイルのエンコーディングがUTF-8であることを確認
- ヘッダー行が正しいことを確認

### 取り込みが失敗する

- ブラウザのコンソールでエラーメッセージを確認
- APIログを確認（ラズパイ5で `docker compose logs api`）
- CSVファイルの形式を確認

### データが登録されない

- 取込履歴でジョブのステータスを確認
- サマリにエラーメッセージがないか確認
- データベースを直接確認（必要に応じて）

