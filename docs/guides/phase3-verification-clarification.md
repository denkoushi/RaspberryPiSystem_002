# Phase 3実機検証の整理と明確化

最終更新: 2025-12-16

## Phase 3の機能と実運用での扱い

### 1. CSVインポート後の自動バックアップ機能（タスク3.1）

**実運用での扱い**: **システムが自動で実行する機能**

- CSVインポートが成功した時に、自動的にバックアップを実行
- スケジュール実行でも手動実行でも、インポート成功時に自動実行される
- ユーザーは設定ファイル（`backup.json`）で有効/無効を切り替える

**検証の目的**: 
- CSVインポート成功時に、自動的にバックアップが実行されることを確認
- バックアップ履歴が`BackupHistory`テーブルに記録されることを確認

**検証方法**:
- ✅ **自動検証可能**: APIを呼び出してCSVインポートを実行し、自動バックアップが動作することを確認
- ✅ **自動検証可能**: データベースの`BackupHistory`テーブルを確認して履歴が記録されることを確認

### 2. Dropboxからのリストア機能（タスク3.2）

**実運用での扱い**: **ユーザー（管理者）が手動で実行する機能**

- 管理画面から、Dropboxに保存されているバックアップを選択してリストア
- 災害復旧時やデータ復元時に使用
- ユーザーが明示的に操作する必要がある

**検証の目的**:
- Dropboxからバックアップをダウンロードしてリストアできることを確認
- バックアップファイルの整合性検証が動作することを確認
- リストア履歴が`BackupHistory`テーブルに記録されることを確認

**検証方法**:
- ⚠️ **手動検証が必要**: 管理画面から操作する機能のため、UI操作が必要
- ✅ **自動検証可能**: APIを直接呼び出してリストア機能が動作することを確認（認証トークンがあれば）

### 3. バックアップ履歴API（タスク3.4, 3.6）

**実運用での扱い**: **ユーザー（管理者）が確認する機能**

- 管理画面でバックアップ・リストアの履歴を確認
- フィルタ・ページング機能で履歴を検索
- 監視・監査目的で使用

**検証の目的**:
- バックアップ・リストアの履歴が正しく記録されることを確認
- 履歴APIが正しく動作することを確認

**検証方法**:
- ✅ **自動検証可能**: APIを直接呼び出して履歴が取得できることを確認（認証トークンがあれば）
- ⚠️ **手動検証が必要**: 管理画面での表示確認はUI操作が必要

## 検証の優先順位と方法

### 優先度1: システムが自動実行する機能の検証（最重要）

**CSVインポート後の自動バックアップ機能**

これは**システムが自動で実行する機能**なので、実際に動作することを確認する必要があります。

**検証手順（自動検証可能）**:
1. テスト用CSVファイルを準備
2. `backup.json`に`autoBackupAfterImport.enabled: true`を設定
3. CSVインポートAPIを呼び出してインポートを実行
4. データベースの`BackupHistory`テーブルを確認して、自動バックアップが記録されていることを確認
5. Dropboxにバックアップファイルが作成されていることを確認（Dropboxストレージを使用している場合）

**この検証は私が自動で実行できます**（認証トークンがあれば、または認証をバイパスする方法があれば）

### 優先度2: APIレベルの動作確認（重要）

**Dropboxからのリストア機能、バックアップ履歴API**

これらは**APIレベルで動作確認**できます。

**検証手順（自動検証可能）**:
1. 認証トークンを取得（または認証をバイパス）
2. APIを直接呼び出して動作確認
3. データベースの`BackupHistory`テーブルを確認

**この検証も私が自動で実行できます**（認証トークンがあれば）

### 優先度3: UI操作の確認（補完的）

**管理画面からの操作確認**

これは**UI操作が必要**なので、ユーザーが手動で確認する必要があります。

**検証手順（手動検証が必要）**:
1. 管理画面にログイン
2. バックアップ履歴画面で履歴が表示されることを確認
3. Dropboxからのリストア画面でリストアが実行できることを確認

**この検証はユーザーが手動で実施する必要があります**

## 結論

### 私が自動で検証できる部分

1. ✅ **CSVインポート後の自動バックアップ機能**
   - APIを呼び出してCSVインポートを実行
   - 自動バックアップが動作することを確認
   - `BackupHistory`テーブルに履歴が記録されることを確認

2. ✅ **Dropboxからのリストア機能（APIレベル）**
   - APIを直接呼び出してリストアを実行
   - 整合性検証が動作することを確認
   - `BackupHistory`テーブルに履歴が記録されることを確認

3. ✅ **バックアップ履歴API（APIレベル）**
   - APIを直接呼び出して履歴が取得できることを確認
   - フィルタ・ページング機能が動作することを確認

### ユーザーが手動で検証する必要がある部分

1. ⚠️ **管理画面でのUI操作確認**
   - バックアップ履歴画面での表示確認
   - Dropboxからのリストア画面での操作確認

## 推奨される検証アプローチ

1. **まず、私が自動で検証できる部分を実施**
   - CSVインポート後の自動バックアップ機能の動作確認
   - APIレベルの動作確認

2. **その後、必要に応じてユーザーがUI操作を確認**
   - 管理画面での表示・操作確認

このアプローチにより、**システムが自動実行する機能が正しく動作することを確実に確認**できます。
