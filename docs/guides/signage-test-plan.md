---
title: デジタルサイネージ機能 テスト計画
tags: [テスト, デジタルサイネージ, サイネージ]
audience: [開発者, テスター, QA]
last-verified: 2025-11-28
related: [../modules/signage/README.md, verification-checklist.md]
category: guides
update-frequency: medium
---

# デジタルサイネージ機能 テスト計画

## 概要

デジタルサイネージ機能のテスト計画です。macでのテスト、CIでのテスト、実機テストの各フェーズで実施するテスト項目を定義します。

## テスト環境

### macでのテスト
- 開発環境（Docker Compose）
- Mockデータを使用

### CIでのテスト
- GitHub Actions
- Mockデータを使用

### 実機テスト
- Raspberry Pi 5（サーバー）
- Raspberry Pi 3/ZERO2W（サイネージ用クライアント端末）
- HDMIモニター（1920x1080）

## テスト項目

### 1. バックエンドAPIテスト

#### 1.1 スケジュール取得API（GET `/api/signage/schedules`）

**テストケース**:
- [ ] 正常系: 有効なスケジュール一覧が取得できる
- [ ] 正常系: 無効なスケジュールは除外される
- [ ] 正常系: 優先順位順にソートされる
- [ ] 異常系: 認証なしでアクセスした場合、401エラーが返る

**実装方法**:
```bash
# macでのテスト
cd apps/api
pnpm test src/routes/signage/schedules.test.ts
```

#### 1.2 コンテンツ取得API（GET `/api/signage/content`）

**テストケース**:
- [ ] 正常系: 現在時刻に基づいて適切なコンテンツが取得できる
- [ ] 正常系: 緊急表示が有効な場合、緊急表示が優先される
- [ ] 正常系: 複数のスケジュールが重複した場合、優先順位が高いものが選択される
- [ ] 正常系: スケジュールが一致しない場合、デフォルトコンテンツが返る
- [ ] 正常系: 工具管理データが正しく取得できる
- [ ] 正常系: PDF情報が正しく取得できる
- [ ] 正常系: 分割表示の場合、工具管理データとPDFの両方が返る

**実装方法**:
```bash
# macでのテスト
cd apps/api
pnpm test src/routes/signage/content.test.ts
```

#### 1.3 PDF管理API（GET/POST/DELETE `/api/signage/pdfs`）

**テストケース**:
- [ ] 正常系: PDF一覧が取得できる
- [ ] 正常系: PDFをアップロードできる
- [ ] 正常系: PDFを削除できる
- [ ] 正常系: PDFの表示モードを更新できる
- [ ] 異常系: 無効なPDFファイルをアップロードした場合、400エラーが返る
- [ ] 異常系: 存在しないPDFを削除した場合、404エラーが返る
- [ ] 異常系: 認証なしでアクセスした場合、401エラーが返る

**実装方法**:
```bash
# macでのテスト
cd apps/api
pnpm test src/routes/signage/pdfs.test.ts
```

#### 1.4 緊急表示API（GET/POST/PUT `/api/signage/emergency`）

**テストケース**:
- [ ] 正常系: 緊急表示情報が取得できる
- [ ] 正常系: 緊急表示を設定できる
- [ ] 正常系: 緊急表示を更新できる
- [ ] 正常系: 有効期限が過ぎた緊急表示は無効になる
- [ ] 異常系: 認証なしでアクセスした場合、401エラーが返る

**実装方法**:
```bash
# macでのテスト
cd apps/api
pnpm test src/routes/signage/emergency.test.ts
```

### 2. フロントエンドテスト（管理画面）

#### 2.1 スケジュール設定画面（`/admin/signage/schedules`）

**テストケース**:
- [ ] 正常系: スケジュール一覧が表示される
- [ ] 正常系: スケジュールを新規作成できる
- [ ] 正常系: スケジュールを編集できる
- [ ] 正常系: スケジュールを削除できる
- [ ] 正常系: 曜日・時間帯・優先順位を設定できる
- [ ] 正常系: PDFを選択できる
- [ ] 正常系: 表示パターンを選択できる
- [ ] 異常系: 無効な入力値の場合、バリデーションエラーが表示される

**実装方法**:
```bash
# macでのテスト
cd apps/web
pnpm test src/pages/admin/signage/SchedulesPage.test.tsx
```

#### 2.2 PDF管理画面（`/admin/signage/pdfs`）

**テストケース**:
- [ ] 正常系: PDF一覧が表示される
- [ ] 正常系: PDFをアップロードできる
- [ ] 正常系: PDFを削除できる
- [ ] 正常系: PDFの表示モードを変更できる
- [ ] 正常系: スライドショー間隔を設定できる
- [ ] 異常系: 無効なPDFファイルをアップロードした場合、エラーメッセージが表示される

**実装方法**:
```bash
# macでのテスト
cd apps/web
pnpm test src/pages/admin/signage/PdfsPage.test.tsx
```

#### 2.3 緊急表示設定画面（`/admin/signage/emergency`）

**テストケース**:
- [ ] 正常系: 緊急表示の設定が表示される
- [ ] 正常系: 緊急表示を有効化できる
- [ ] 正常系: 緊急表示を無効化できる
- [ ] 正常系: 緊急メッセージを設定できる
- [ ] 正常系: 有効期限を設定できる
- [ ] 正常系: PDFを選択できる

**実装方法**:
```bash
# macでのテスト
cd apps/web
pnpm test src/pages/admin/signage/EmergencyPage.test.tsx
```

### 3. フロントエンドテスト（サイネージ表示画面）

#### 3.1 サイネージ表示画面（`/signage`）

**テストケース**:
- [ ] 正常系: スケジュールに基づいてコンテンツが表示される
- [ ] 正常系: 工具管理データが表示される
- [ ] 正常系: PDFが表示される
- [ ] 正常系: 分割表示が正しく動作する
- [ ] 正常系: ポーリングで定期的に更新される
- [ ] 正常系: 緊急表示が最優先で表示される
- [ ] 正常系: オフライン時にエラーメッセージが表示される
- [ ] 正常系: スライドショー形式でPDFページが自動切り替えされる
- [ ] 正常系: 1ページ表示形式でPDFが表示される

**実装方法**:
```bash
# macでのテスト
cd apps/web
pnpm test src/pages/signage/SignageDisplayPage.test.tsx

# E2Eテスト（Playwright）
pnpm test:e2e signage-display.spec.ts
```

### 4. 統合テスト

#### 4.1 スケジュール管理フロー全体

**テストケース**:
- [ ] 正常系: スケジュール作成 → コンテンツ取得 → 表示の一連の流れが動作する
- [ ] 正常系: 複数のスケジュールが正しく優先順位で処理される
- [ ] 正常系: スケジュールの有効/無効が正しく反映される

**実装方法**:
```bash
# E2Eテスト（Playwright）
cd apps/web
pnpm test:e2e signage-schedule-flow.spec.ts
```

#### 4.2 PDFアップロード・表示フロー

**テストケース**:
- [ ] 正常系: PDFアップロード → スケジュール設定 → 表示の一連の流れが動作する
- [ ] 正常系: USB経由のPDFアップロードが動作する
- [ ] 正常系: PDFの削除が正しく反映される

**実装方法**:
```bash
# E2Eテスト（Playwright）
cd apps/web
pnpm test:e2e signage-pdf-flow.spec.ts
```

### 5. パフォーマンステスト

#### 5.1 コンテンツ取得のパフォーマンス

**テストケース**:
- [ ] 正常系: コンテンツ取得が1秒以内に完了する
- [ ] 正常系: ポーリングが30秒間隔で正常に動作する
- [ ] 正常系: 複数のスケジュールがある場合でもパフォーマンスが維持される

**実装方法**:
```bash
# macでのテスト
cd apps/api
pnpm test src/routes/signage/content.perf.test.ts
```

#### 5.2 PDF表示のパフォーマンス

**テストケース**:
- [ ] 正常系: PDFの読み込みが3秒以内に完了する
- [ ] 正常系: スライドショーの切り替えがスムーズに動作する
- [ ] 正常系: ラズパイZERO2Wでも動作する（軽量化が必要）

**実装方法**:
```bash
# 実機テスト
# ラズパイZERO2Wで動作確認
```

### 6. 実機テスト

#### 6.1 Raspberry Pi 5での動作確認

**テストケース**:
- [ ] 正常系: Dockerコンテナが正常に起動する
- [ ] 正常系: PDFディレクトリが正しくマウントされる
- [ ] 正常系: PDFが正しく保存される
- [ ] 正常系: APIが正常に動作する

**実装方法**:
```bash
# 実機で実行
cd /opt/RaspberryPiSystem_002
./scripts/server/deploy.sh feature/digital-signage

# 動作確認
curl http://localhost:8080/api/system/health
curl http://localhost:8080/api/signage/schedules
```

#### 6.2 Raspberry Pi 3/ZERO2Wでの動作確認

**テストケース**:
- [ ] 正常系: サイネージ画面が正常に表示される
- [ ] 正常系: スケジュールに基づいてコンテンツが切り替わる
- [ ] 正常系: 工具管理データが正しく表示される
- [ ] 正常系: PDFが正しく表示される
- [ ] 正常系: 分割表示が正しく動作する
- [ ] 正常系: 緊急表示が最優先で表示される
- [ ] 正常系: キオスクモードで自動起動する
- [ ] 正常系: 全画面表示が正しく動作する

**実装方法**:
```bash
# 実機で実行
# ブラウザで http://raspberry-pi-5:443/signage にアクセス
# または、キオスクモードで自動起動
```

### 7. 運用テスト

#### 7.1 スケジュールの長期運用

**テストケース**:
- [ ] 正常系: 1週間連続でスケジュールが正しく動作する
- [ ] 正常系: 曜日・時間帯の切り替えが正しく動作する
- [ ] 正常系: 優先順位が正しく適用される

**実装方法**:
```bash
# 実機で実行
# 1週間連続で動作確認
```

#### 7.2 PDFの長期保存

**テストケース**:
- [ ] 正常系: PDFが長期保存される
- [ ] 正常系: PDFの削除が正しく動作する
- [ ] 正常系: ストレージ容量が適切に管理される

**実装方法**:
```bash
# 実機で実行
# 長期運用で動作確認
```

## テスト実行順序とベストプラクティス

### 推奨アプローチ: Phaseごとに進める

**ベストプラクティス**: Phaseごとに、macテスト → CIテスト → 実機テストの順で進める

#### Phase 1: データベーススキーマとAPI実装

1. **macテスト**: 統合テストを実装・実行
2. **CIテスト**: GitHub Actionsで自動実行
3. **実機テスト**: Raspberry Pi 5でAPI動作確認

#### Phase 2: 管理画面の実装

1. **macテスト**: コンポーネントテスト、E2Eテスト
2. **CIテスト**: GitHub Actionsで自動実行
3. **実機テスト**: Raspberry Pi 5で管理画面動作確認

#### Phase 3: サイネージ表示画面の実装

1. **macテスト**: コンポーネントテスト、E2Eテスト
2. **CIテスト**: GitHub Actionsで自動実行
3. **実機テスト**: Raspberry Pi 3/ZERO2Wでサイネージ表示動作確認

#### Phase 4: クライアント端末セットアップ

1. **macテスト**: セットアップスクリプトのテスト
2. **CIテスト**: スクリプトの構文チェック
3. **実機テスト**: Raspberry Pi 3/ZERO2Wでセットアップ動作確認

## テスト実装の優先順位

すべてのテストを一度に実装するのではなく、**優先順位をつけて段階的に実装**します：

### 優先度1: 必須テスト（実装必須）
- **統合テスト**: APIエンドポイントの動作確認
- **CIテスト**: 自動化されたテストで回帰を防ぐ
- **実機テスト（基本動作）**: 実際のハードウェアでの基本動作確認

### 優先度2: 推奨テスト（実装推奨）
- **単体テスト**: 複雑なロジックの検証
- **E2Eテスト**: ユーザーシナリオの検証
- **実機テスト（詳細）**: エッジケースやパフォーマンスの確認

### 優先度3: オプショナルテスト（実装任意）
- **パフォーマンステスト**: 負荷テスト、ストレステスト
- **セキュリティテスト**: 脆弱性スキャン
- **運用テスト**: 長期運用の検証

## 関連ドキュメント

- [デジタルサイネージモジュール仕様](../modules/signage/README.md)
- [検証チェックリスト](verification-checklist.md)
- [開発ガイド](development.md)

