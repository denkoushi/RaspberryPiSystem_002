---
title: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ - ãã®ä»–
tags: [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°, ã‚¤ãƒ³ãƒ•ãƒ©]
audience: [é–‹ç™ºè€…, é‹ç”¨è€…]
last-verified: 2025-12-29
related: [../index.md, ../../guides/deployment.md]
category: knowledge-base
update-frequency: medium
---

# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ - ãã®ä»–

**ã‚«ãƒ†ã‚´ãƒª**: ã‚¤ãƒ³ãƒ•ãƒ©é–¢é€£ > ãã®ä»–  
**ä»¶æ•°**: 17ä»¶  
**ç´¢å¼•**: [index.md](../index.md)

ãã®ä»–ã®ã‚¤ãƒ³ãƒ•ãƒ©é–¢é€£ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±

---

### [KB-018] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è€æ€§ã®å®Ÿè£…

**EXEC_PLAN.mdå‚ç…§**: Validation 6 (è¡Œ30-31)

**äº‹è±¡**: 
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«NFCã‚¤ãƒ™ãƒ³ãƒˆãŒå¤±ã‚ã‚Œã‚‹
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°å¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œãªã„

**è¦å› **: 
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è€æ€§æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-24ï¼‰: NFCã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«SQLiteã‚­ãƒ¥ãƒ¼ã‚’å®Ÿè£…ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…

**å­¦ã‚“ã ã“ã¨**: 
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è€æ€§ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-24ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `clients/nfc-agent/src/nfc_agent/queue.py`
- `clients/nfc-agent/src/nfc_agent/agent.py`

---

---

### [KB-019] USBä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½ã®å®Ÿè£…

**EXEC_PLAN.mdå‚ç…§**: Validation 7 (è¡Œ31-32)

**äº‹è±¡**: 
- USBãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**è¦å› **: 
- æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-25ï¼‰: USBãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…

**å­¦ã‚“ã ã“ã¨**: 
- CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©åˆ‡ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†ã‹ã‚Šã‚„ã™ãã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-25ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/routes/imports.ts`
- `apps/web/src/pages/admin/MasterImportPage.tsx`

---

---

### [KB-021] ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…

**EXEC_PLAN.mdå‚ç…§**: æ¬¡ã®ã‚¿ã‚¹ã‚¯ (è¡Œ119)

**äº‹è±¡**: 
- ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**è¦å› **: 
- æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **å®Ÿè£…å®Œäº†**ï¼ˆ2025-11-25ï¼‰: ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè£…ã—ã€CIãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 

**å­¦ã‚“ã ã“ã¨**: 
- ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å¥å…¨æ€§ã‚’ä¿ã¤ãŸã‚ã«é‡è¦
- CIãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã§ãã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **å®Ÿè£…å®Œäº†**ï¼ˆ2025-11-25ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `scripts/server/monitor.sh`
- `scripts/test/monitor.test.sh`
- `apps/api/src/routes/system/health.ts`
- `apps/api/src/routes/system/metrics.ts`

---

---

### [KB-034] ãƒ©ã‚ºãƒ‘ã‚¤ã®ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®šï¼ˆEUC-JPï¼‰ã«ã‚ˆã‚‹æ–‡å­—åŒ–ã‘

**EXEC_PLAN.mdå‚ç…§**: Phase 6 å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆï¼ˆUSBæ¥ç¶šã‚«ãƒ¡ãƒ©é€£æºï¼‰ï¼ˆ2025-11-28ï¼‰

**äº‹è±¡**: 
- ãƒ©ã‚ºãƒ‘ã‚¤5ã§UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ–‡å­—åŒ–ã‘ã™ã‚‹
- `nano`ã‚¨ãƒ‡ã‚£ã‚¿ã§æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œãªã„
- Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§`UnicodeDecodeError: 'euc_jp' codec can't decode byte 0xe7`ã‚¨ãƒ©ãƒ¼

**è¦å› **: 
- ãƒ©ã‚ºãƒ‘ã‚¤5ã®OSå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã€ãƒ­ã‚±ãƒ¼ãƒ«ãŒEUC-JPï¼ˆ`ja_JP.eucJP`ï¼‰ã«è¨­å®šã•ã‚Œã¦ã„ãŸ
- UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’EUC-JPã¨ã—ã¦èª­ã¿è¾¼ã‚‚ã†ã¨ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§`encoding='utf-8'`ã‚’æ˜ç¤º â†’ **éƒ¨åˆ†çš„ã«æˆåŠŸ**ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å‹•ä½œã—ãŸãŒã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å•é¡Œã¯è§£æ±ºã—ãªã„ï¼‰
- [è©¦è¡Œ2] `sudo raspi-config`ã§ãƒ­ã‚±ãƒ¼ãƒ«ã‚’UTF-8ï¼ˆ`ja_JP.UTF-8`ï¼‰ã«å¤‰æ›´ â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰: 
  1. `sudo raspi-config`ã‚’å®Ÿè¡Œ
  2. `5 Localisation Options` â†’ `L1 Locale`ã‚’é¸æŠ
  3. `ja_JP.UTF-8 UTF-8`ã‚’é¸æŠã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ã‚±ãƒ¼ãƒ«ã«è¨­å®š
  4. ãƒ©ã‚ºãƒ‘ã‚¤ã‚’å†èµ·å‹•

**å­¦ã‚“ã ã“ã¨**: 
- **ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®šã¯é‡è¦**: æ—¥æœ¬èªç’°å¢ƒã§ã¯ã€EUC-JPã¨UTF-8ã®æ··åœ¨ã«æ³¨æ„ãŒå¿…è¦
- **OSå†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ç¢ºèª**: Raspberry Pi Imagerã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã€ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèªã™ã‚‹
- **æ–‡å­—åŒ–ã‘ã®è¨ºæ–­**: `locale`ã‚³ãƒãƒ³ãƒ‰ã§ç¾åœ¨ã®ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèªã§ãã‚‹
- **Pythonã§ã®å¯¾å‡¦**: `open(file, encoding='utf-8')`ã§æ˜ç¤ºçš„ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ä¸€æ™‚çš„ã«å›é¿ã§ãã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- ãªã—ï¼ˆã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å•é¡Œï¼‰

---

---

### [KB-039] CPUæ¸©åº¦å–å¾—ã®Dockerå¯¾å¿œï¼ˆ/sys/class/thermalãƒã‚¦ãƒ³ãƒˆï¼‰

**EXEC_PLAN.mdå‚ç…§**: Phase 6 å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆï¼ˆUSBæ¥ç¶šã‚«ãƒ¡ãƒ©é€£æºï¼‰ï¼ˆ2025-11-28ï¼‰

**äº‹è±¡**: 
- ã‚­ã‚ªã‚¹ã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ã«CPUæ¸©åº¦ãƒ»è² è·ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ãŸãŒã€æ¸©åº¦ãŒè¡¨ç¤ºã•ã‚Œãªã„
- APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§`cpuTemp: null`ãŒè¿”ã•ã‚Œã‚‹
- `vcgencmd measure_temp`ã‚³ãƒãƒ³ãƒ‰ãŒDockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã§ããªã„

**è¦å› **: 
- `vcgencmd`ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ›ã‚¹ãƒˆã®ã‚³ãƒãƒ³ãƒ‰ã§ã€Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ã¯ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ãƒ›ã‚¹ãƒˆã®ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] `vcgencmd measure_temp`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ â†’ **å¤±æ•—**ï¼ˆDockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼‰
- [è©¦è¡Œ2] `/sys/class/thermal/thermal_zone0/temp`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹æ–¹å¼ã«å¤‰æ›´ â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰: 
  1. `/sys/class/thermal/thermal_zone0/temp`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹æ–¹å¼ã«å¤‰æ›´ï¼ˆãƒŸãƒªåº¦ã§è¿”ã•ã‚Œã‚‹ãŸã‚ã€1000ã§å‰²ã£ã¦åº¦ã«å¤‰æ›ï¼‰
  2. Docker Composeã§`/sys/class/thermal`ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒã‚¦ãƒ³ãƒˆ: `- /sys/class/thermal:/sys/class/thermal:ro`
  3. `fs/promises`ã®`readFile`ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Š
  4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ”¹å–„ã—ã€ãƒ­ã‚°å‡ºåŠ›ã‚’`info`ãƒ¬ãƒ™ãƒ«ã«å¤‰æ›´

**å­¦ã‚“ã ã“ã¨**: 
- **Dockerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—**: `/sys`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã§ã€ãƒ›ã‚¹ãƒˆã®ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚ˆã‚Šã‚‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹æ–¹ãŒç¢ºå®Ÿã§è»½é‡
- **ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆ**: èª­ã¿å–ã‚Šå°‚ç”¨ï¼ˆ`:ro`ï¼‰ã§ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç¢ºä¿
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã‚ãªã„å ´åˆï¼ˆéãƒ©ã‚ºãƒ‘ã‚¤ç’°å¢ƒãªã©ï¼‰ã¯ã€`null`ã‚’è¿”ã—ã¦å‡¦ç†ã‚’ç¶™ç¶š

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/routes/system/system-info.ts`
- `infrastructure/docker/docker-compose.server.yml`

---

---

### [KB-041] Wi-Fiå¤‰æ›´æ™‚ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šãŒæ‰‹å‹•ã§å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã ã£ãŸå•é¡Œï¼ˆç’°å¢ƒå¤‰æ•°åŒ–ï¼‰

**EXEC_PLAN.mdå‚ç…§**: Progress (2025-11-28)

**äº‹è±¡**: 
- Wi-FiãŒå¤‰ã‚ã‚‹ã¨ã€ãƒ©ã‚ºãƒ‘ã‚¤4ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã‚‹
- Caddyfile.localã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‰‹å‹•ã§æ›´æ–°ã—ã¦ã€Webã‚³ãƒ³ãƒ†ãƒŠã‚’å†ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸ
- å†ãƒ“ãƒ«ãƒ‰ã«æ™‚é–“ãŒã‹ã‹ã‚Šã€é‹ç”¨ãŒç…©é›‘ã ã£ãŸ

**è¦å› **: 
- Caddyfile.localã«IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãŸ
- Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«Caddyfile.localãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´æ™‚ã«å†ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã ã£ãŸ
- ç’°å¢ƒå¤‰æ•°ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã§ãã‚‹ä»•çµ„ã¿ãŒãªã‹ã£ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] Caddyfile.localã‚’ç›´æ¥ç·¨é›†ã—ã¦å†ãƒ“ãƒ«ãƒ‰ â†’ **æˆåŠŸã—ãŸãŒé‹ç”¨ãŒç…©é›‘**
- [è©¦è¡Œ2] Caddyfile.localã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—ã€èµ·å‹•æ™‚ã«ç’°å¢ƒå¤‰æ•°ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç½®æ› â†’ **æˆåŠŸ**ï¼ˆå†ãƒ“ãƒ«ãƒ‰ä¸è¦ã§å¯¾å¿œå¯èƒ½ï¼‰

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰: 
  1. Caddyfile.localã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ï¼ˆ`Caddyfile.local.template`ï¼‰ã—ã€`$NFC_AGENT_HOST`ã‚’ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨
  2. Dockerfile.webã§èµ·å‹•æ™‚ã«`sed`ã‚³ãƒãƒ³ãƒ‰ã§ç’°å¢ƒå¤‰æ•°`NFC_AGENT_HOST`ã®å€¤ã‚’ç½®æ›ã—ã¦Caddyfile.localã‚’ç”Ÿæˆ
  3. docker-compose.server.ymlã§ç’°å¢ƒå¤‰æ•°`NFC_AGENT_HOST`ã‚’è¨­å®šå¯èƒ½ã«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤: `192.168.128.102`ï¼‰
  4. Wi-Fiå¤‰æ›´æ™‚ã¯ã€ç’°å¢ƒå¤‰æ•°ã‚’å¤‰æ›´ã—ã¦Webã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹ã ã‘ã§å¯¾å¿œå¯èƒ½ï¼ˆå†ãƒ“ãƒ«ãƒ‰ä¸è¦ï¼‰

**å­¦ã‚“ã ã“ã¨**: 
- **ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šã®æŸ”è»Ÿæ€§**: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤ã‚’ç’°å¢ƒå¤‰æ•°åŒ–ã™ã‚‹ã“ã¨ã§ã€å†ãƒ“ãƒ«ãƒ‰ä¸è¦ã§è¨­å®šå¤‰æ›´ãŒå¯èƒ½
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã®é‡è¦æ€§**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—ã€èµ·å‹•æ™‚ã«å‹•çš„ã«ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€é‹ç”¨ã®æŸ”è»Ÿæ€§ãŒå‘ä¸Š
- **Docker Composeã®ç’°å¢ƒå¤‰æ•°**: `${ENV_VAR:-default}`å½¢å¼ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã§ãã‚‹
- **é‹ç”¨ã®ç°¡ç´ åŒ–**: å†ãƒ“ãƒ«ãƒ‰ä¸è¦ã§è¨­å®šå¤‰æ›´ã§ãã‚‹ã“ã¨ã§ã€é‹ç”¨ã‚³ã‚¹ãƒˆãŒå¤§å¹…ã«å‰Šæ¸›

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `infrastructure/docker/Caddyfile.local.template`
- `infrastructure/docker/Dockerfile.web`
- `infrastructure/docker/docker-compose.server.yml`

---

---

### [KB-042] pdf-popplerãŒLinuxï¼ˆARM64ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: Progress (2025-11-28)

**äº‹è±¡**: 
- ãƒ‡ã‚¸ã‚¿ãƒ«ã‚µã‚¤ãƒãƒ¼ã‚¸æ©Ÿèƒ½ã§PDFã‚’ç”»åƒã«å¤‰æ›ã™ã‚‹éš›ã€`pdf-poppler`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ãŸ
- Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§`pdf-poppler`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨ã€Œlinux is NOT supported.ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- APIã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã§ããªã„

**è¦å› **: 
- `pdf-poppler`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯`darwin`ï¼ˆmacOSï¼‰ã¨`win32`ï¼ˆWindowsï¼‰ã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹
- Linuxï¼ˆARM64ï¼‰ç’°å¢ƒã§ã¯å‹•ä½œã—ãªã„
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`index.js`ã§ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ãŒã‚ã‚Šã€Linuxã®å ´åˆã¯`process.exit(1)`ã§çµ‚äº†ã™ã‚‹

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] `pdf-poppler`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ â†’ **å¤±æ•—**ï¼ˆLinuxç’°å¢ƒã§å‹•ä½œã—ãªã„ï¼‰
- [è©¦è¡Œ2] Popplerã®CLIãƒ„ãƒ¼ãƒ«ï¼ˆ`pdftoppm`ï¼‰ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹æ–¹å¼ã«å¤‰æ›´ â†’ **æˆåŠŸ**ï¼ˆLinuxç’°å¢ƒã§å‹•ä½œï¼‰

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰: 
  1. `pdf-poppler`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤
  2. Popplerã®CLIãƒ„ãƒ¼ãƒ«ï¼ˆ`pdftoppm`ï¼‰ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹`pdf-converter.ts`ã‚’ä½œæˆ
  3. `child_process.spawn`ã‚’ä½¿ç”¨ã—ã¦`pdftoppm`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
  4. Dockerfile.apiã§`poppler-utils`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼‰
  5. PDFã‚’JPEGå½¢å¼ã§ç”»åƒã«å¤‰æ›ã—ã€æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜

**å­¦ã‚“ã ã“ã¨**: 
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¢ºèª**: npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã™ã¹ã¦ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãªã„
- **CLIãƒ„ãƒ¼ãƒ«ã®ç›´æ¥ä½¿ç”¨**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å ´åˆã€CLIãƒ„ãƒ¼ãƒ«ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹æ–¹ãŒç¢ºå®Ÿ
- **Dockerç’°å¢ƒã§ã®å‹•ä½œç¢ºèª**: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆmacOSï¼‰ã§å‹•ä½œã—ã¦ã‚‚ã€Dockerç’°å¢ƒï¼ˆLinuxï¼‰ã§å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚‹
- **Popplerã®CLIãƒ„ãƒ¼ãƒ«**: `pdftoppm`ã¯Linuxç’°å¢ƒã§æ¨™æº–çš„ã«ä½¿ç”¨ã§ãã‚‹PDFå¤‰æ›ãƒ„ãƒ¼ãƒ«

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-28ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/lib/pdf-converter.ts`
- `apps/api/src/lib/pdf-storage.ts`
- `apps/api/package.json`
- `infrastructure/docker/Dockerfile.api`

---

---

### [KB-048] NFCã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Dockerãƒ“ãƒ«ãƒ‰ã§uvicornãŒè¦‹ã¤ã‹ã‚‰ãªã„å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: Phase 8 / Surprises & Discoveries (è¡Œ621)

**äº‹è±¡**: 
- NFCã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã¨ `ModuleNotFoundError: No module named 'uvicorn'` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
- ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ç›´å¾Œã«çµ‚äº†ã—ã€å†èµ·å‹•ã‚’ç¹°ã‚Šè¿”ã™
- `poetry install` ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ãŒã€ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

**è¦å› **: 
- `Dockerfile.nfc-agent` ã® `poetry install` ã‚³ãƒãƒ³ãƒ‰ã« `--no-dev --no-root` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã•ã‚Œã¦ã„ãŸ
- Poetry 2.x ã§ã¯ `--no-dev` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå»ƒæ­¢ã•ã‚Œã€`--without dev` ã«å¤‰æ›´ã•ã‚ŒãŸ
- `|| true` ãŒå«ã¾ã‚Œã¦ã„ãŸãŸã‚ã€`poetry install` ãŒå¤±æ•—ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãŒç„¡è¦–ã•ã‚Œã¦ã„ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] `poetry install` ã®ãƒ­ã‚°ã‚’ç¢ºèª â†’ **å•é¡Œç™ºè¦‹**ï¼ˆ`--no-dev` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ï¼‰
- [è©¦è¡Œ2] `--no-dev` ã‚’ `--without dev` ã«å¤‰æ›´ã—ã€`|| true` ã‚’å‰Šé™¤ â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-29ï¼‰:
  1. `infrastructure/docker/Dockerfile.nfc-agent` ã® `poetry install` ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿®æ­£
  2. `--no-dev` ã‚’ `--without dev` ã«å¤‰æ›´ï¼ˆPoetry 2.xå¯¾å¿œï¼‰
  3. `|| true` ã‚’å‰Šé™¤ã—ã¦ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ãƒ“ãƒ«ãƒ‰ã‚’å¤±æ•—ã•ã›ã‚‹ã‚ˆã†ã«å¤‰æ›´
  4. ã“ã‚Œã«ã‚ˆã‚Šã€ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆuvicornå«ã‚€ï¼‰ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ

**å­¦ã‚“ã ã“ã¨**: 
- **Poetryã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§**: Poetry 2.xã§ã¯ `--no-dev` ãŒ `--without dev` ã«å¤‰æ›´ã•ã‚ŒãŸ
- **ã‚¨ãƒ©ãƒ¼ã®ç„¡è¦–ã¯å±é™º**: `|| true` ã§ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã™ã‚‹ã¨ã€å¾Œã§å•é¡ŒãŒç™ºè¦‹ã—ã«ãããªã‚‹
- **ãƒ“ãƒ«ãƒ‰æ™‚ã®ã‚¨ãƒ©ãƒ¼æ¤œå‡º**: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ãŸå ´åˆã¯ã€ãƒ“ãƒ«ãƒ‰ã‚’å¤±æ•—ã•ã›ã‚‹ã“ã¨ã§æ—©æœŸã«å•é¡Œã‚’ç™ºè¦‹ã§ãã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-29ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `infrastructure/docker/Dockerfile.nfc-agent`

---

---

### [KB-049] NFCã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®Dockerãƒ“ãƒ«ãƒ‰ã§gccãŒè¦‹ã¤ã‹ã‚‰ãªã„å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: Phase 8 / Surprises & Discoveries (è¡Œ621)

**äº‹è±¡**: 
- NFCã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰æ™‚ã« `error: command 'gcc' failed: No such file or directory` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
- `pyscard` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«Cæ‹¡å¼µã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€gccãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„
- `poetry install` ãŒå¤±æ•—ã—ã€ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„

**è¦å› **: 
- `Dockerfile.nfc-agent` ã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒ `python:3.11-slim` ã§ã€ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ï¼ˆgccã€swigãªã©ï¼‰ãŒå«ã¾ã‚Œã¦ã„ãªã„
- `pyscard` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯Cæ‹¡å¼µã‚’å«ã‚€ãŸã‚ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå¿…è¦
- `pcscd` ã¨ `libpcsclite-dev` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãŸãŒã€Cã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒä¸è¶³ã—ã¦ã„ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] `poetry install` ã®ãƒ­ã‚°ã‚’ç¢ºèª â†’ **å•é¡Œç™ºè¦‹**ï¼ˆgccãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼‰
- [è©¦è¡Œ2] `Dockerfile.nfc-agent` ã« `build-essential` ã¨ `swig` ã‚’è¿½åŠ  â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-29ï¼‰:
  1. `infrastructure/docker/Dockerfile.nfc-agent` ã® `apt-get install` ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿®æ­£
  2. `build-essential`ï¼ˆgccã€makeãªã©ï¼‰ã¨ `swig`ï¼ˆpyscardã®ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ï¼‰ã‚’è¿½åŠ 
  3. ã“ã‚Œã«ã‚ˆã‚Šã€`pyscard` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Cæ‹¡å¼µãŒæ­£å¸¸ã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã€ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ

**å­¦ã‚“ã ã“ã¨**: 
- **Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰è¦ä»¶**: Cæ‹¡å¼µã‚’å«ã‚€Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆpyscardãªã©ï¼‰ã¯ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå¿…è¦
- **slimã‚¤ãƒ¡ãƒ¼ã‚¸ã®åˆ¶é™**: `python:3.11-slim` ã¯è»½é‡ã ãŒã€ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã€å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- **ä¾å­˜é–¢ä¿‚ã®ç¢ºèª**: Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰è¦ä»¶ã‚’äº‹å‰ã«ç¢ºèªã—ã€å¿…è¦ãªãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã‚’Dockerfileã«å«ã‚ã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-29ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `infrastructure/docker/Dockerfile.nfc-agent`

---

---

### [KB-050] è»½é‡ã‚µã‚¤ãƒãƒ¼ã‚¸ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè‡ªå·±ç½²åè¨¼æ˜æ›¸ã§ç”»åƒã‚’å–å¾—ã§ããªã„

**EXEC_PLAN.mdå‚ç…§**: Phase 8 / Surprises & Discoveries (è¡Œ655ä»˜è¿‘)

**äº‹è±¡**:
- Raspberry Pi 3 ã®è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ `/api/signage/current-image` ã®å–å¾—ã«å¤±æ•—ã—ã€`feh: No loadable images specified` ã§ã‚µãƒ¼ãƒ“ã‚¹ãŒå†èµ·å‹•ã‚’ç¹°ã‚Šè¿”ã™
- `journalctl -u signage-lite` ã§ã¯ `Failed to update image, using cached version` ãŒé€£ç¶šã—ã€`/var/cache/signage/current.jpg` ãŒç”Ÿæˆã•ã‚Œãªã„

**è¦å› **:
- ã‚µãƒ¼ãƒãƒ¼ (Raspberry Pi 5) ãŒè‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€`signage-update.sh` ã® `curl` ãŒè¨¼æ˜æ›¸æ¤œè¨¼ã§å¤±æ•—ã—ã¦ã„ãŸ
- åˆå›å–å¾—ãŒå¤±æ•—ã™ã‚‹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå­˜åœ¨ã›ãš `feh` ãŒèª­ã¿è¾¼ã‚€ç”»åƒãŒãªã„ã¾ã¾çµ‚äº†ã™ã‚‹

**è©¦è¡Œã—ãŸå¯¾ç­–**:
- [è©¦è¡Œ1] ãƒ©ã‚ºãƒ‘ã‚¤3ã§æ‰‹å‹• `curl https://...` ã‚’å®Ÿè¡Œ â†’ **æˆåŠŸ**ï¼ˆ`-k` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ãŸå ´åˆã®ã¿æˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
- [è©¦è¡Œ2] `signage-update.sh` ã‚’æ‰‹å‹•ã§ `curl -k` ã«æ›¸ãæ›ãˆ â†’ **æˆåŠŸ**ï¼ˆç”»åƒå–å¾—ã«æˆåŠŸã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç”Ÿæˆã•ã‚ŒãŸï¼‰
- [è©¦è¡Œ3] ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã« `SIGNAGE_ALLOW_INSECURE_TLS` ã‚’è¿½åŠ ã—ã€åˆå›èµ·å‹•æ™‚ã«ç”»åƒãŒå­˜åœ¨ã™ã‚‹ã¾ã§å¾…æ©Ÿ â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**:
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-30ï¼‰:
  1. `scripts/client/setup-signage-lite.sh` ã§ `SIGNAGE_ALLOW_INSECURE_TLS` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ:true) ã‚’å°å…¥ã—ã€è‡ªå·±ç½²åè¨¼æ˜æ›¸ã§ã‚‚ `curl -k` ã‚’è‡ªå‹•ä»˜ä¸
  2. è¡¨ç¤ºã‚¹ã‚¯ãƒªãƒ—ãƒˆã§åˆå›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è©¦è¡Œã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—å¾…æ©Ÿ
  3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨¼æ˜æ›¸è¨­å®šã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †ã‚’è¿½è¨˜

**å­¦ã‚“ã ã“ã¨**:
- è‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã™ã‚‹é–‰åŸŸç¶²ã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚è¨¼æ˜æ›¸æ¤œè¨¼ã‚’åˆ¶å¾¡ã§ãã‚‹ä»•çµ„ã¿ãŒå¿…é ˆ
- åˆå›èµ·å‹•æ™‚ã«ãƒªã‚½ãƒ¼ã‚¹ãŒæœªå–å¾—ã ã¨ãƒ“ãƒ¥ãƒ¼ã‚¢ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã€å¾…æ©Ÿï¼†å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã¿è¾¼ã‚€ã¹ã
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ç’°å¢ƒå¤‰æ•°ãƒ•ãƒƒã‚¯ã‚’è¨­ã‘ã¦ãŠãã¨ã€å°†æ¥çš„ã«å•†ç”¨è¨¼æ˜æ›¸ã¸åˆ‡ã‚Šæ›¿ãˆã‚‹éš›ã‚‚æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-30ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `scripts/client/setup-signage-lite.sh`
- `docs/modules/signage/signage-lite.md`
- `docs/knowledge-base/infrastructure.md`

---

---

### [KB-053] ã‚µã‚¤ãƒãƒ¼ã‚¸ã®è‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”»åƒãŒæ›´æ–°ã•ã‚Œãªã„ï¼ˆSIGNAGE_RENDER_DIRã®ãƒ‘ã‚¹ä¸ä¸€è‡´ï¼‰

**EXEC_PLAN.mdå‚ç…§**: Phase 8 / Surprises & Discoveries (è¡Œ663ä»˜è¿‘)

**äº‹è±¡**:
- `/api/signage/current-image` ã‚’å–å¾—ã—ã¦ã‚‚å¸¸ã«åŒã˜JPEGãŒè¿”ã‚Šã€è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æœ€æ–°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œãªã„
- `docker compose exec api ls /app/storage/signage-rendered` ã§ã¯æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¢—ãˆã‚‹ãŒã€`current.jpg` ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒæ›´æ–°ã•ã‚Œãªã„

**è¦å› **:
- `SignageRenderStorage` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¿å­˜å…ˆãŒ `/opt/RaspberryPiSystem_002/storage/signage-rendered` ã§ã€APIã‚³ãƒ³ãƒ†ãƒŠå†…ã®å®Ÿãƒ‘ã‚¹ `/app/storage/signage-rendered` ã¨ä¸€è‡´ã—ã¦ã„ãªã‹ã£ãŸ
- ãã®çµæœã€`current.jpg` ã¯ãƒ›ã‚¹ãƒˆå´ã®æœªãƒã‚¦ãƒ³ãƒˆé ˜åŸŸã«ä¿å­˜ã•ã‚Œã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å‚ç…§ã•ã‚Œã‚‹ãƒ‘ã‚¹ã¯æ›´æ–°ã•ã‚Œãªã‹ã£ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**:
- [è©¦è¡Œ1] `current.jpg` ã‚’æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ â†’ **å¤±æ•—**ï¼ˆè‡ªå‹•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒå†ã³å¤ã„ãƒ‘ã‚¹ã«æ›¸ãè¾¼ã‚€ï¼‰
- [è©¦è¡Œ2] `signage-rendered` ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ç¢ºèªã—ã€ç’°å¢ƒå¤‰æ•°ã§ä¿å­˜å…ˆã‚’ä¸Šæ›¸ã â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**:
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-11-30ï¼‰:
  1. `docker-compose.server.yml` ã® `api` ã‚µãƒ¼ãƒ“ã‚¹ã« `SIGNAGE_RENDER_DIR=/app/storage/signage-rendered` ã‚’è¿½åŠ 
  2. ãƒœãƒªãƒ¥ãƒ¼ãƒ  `signage-rendered-storage` ã‚’åŒã˜ãƒ‘ã‚¹ã«ãƒã‚¦ãƒ³ãƒˆã—ã€ãƒ›ã‚¹ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠã§ä¿å­˜å…ˆã‚’çµ±ä¸€
  3. å†ãƒ“ãƒ«ãƒ‰å¾Œã« `current.jpg` ã®æ›´æ–°ãŒå†é–‹ã—ã€è»½é‡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚‚æœ€æ–°ç”»åƒãŒé…ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ

**å­¦ã‚“ã ã“ã¨**:
- ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ›ã‚¹ãƒˆã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹ãŒç•°ãªã‚‹å ´åˆã¯ã€ç’°å¢ƒå¤‰æ•°ã‚„ `.env` ã§æ˜ç¤ºçš„ã«åˆã‚ã›ã‚‹
- `current.jpg` ã®æ›´æ–°çŠ¶æ³ã¯ `ls -lh` ã‚„ `md5sum` ã§ç°¡å˜ã«ç¢ºèªã§ãã€å•é¡Œåˆ‡ã‚Šåˆ†ã‘ã«æœ‰åŠ¹

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `infrastructure/docker/docker-compose.server.yml`
- `apps/api/src/lib/signage-render-storage.ts`

---

---

### [KB-057] SSHæ¥ç¶šã§ãƒ›ã‚¹ãƒˆåè§£æ±ºãŒå¤±æ•—ã—ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãŒé€šã‚‰ãªã„å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: Phase 2.4 å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆï¼ˆ2025-12-01ï¼‰

**äº‹è±¡**: 
- Macã‹ã‚‰Raspberry Pi 5ã«SSHæ¥ç¶šã—ã‚ˆã†ã¨ã—ãŸãŒã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãŒé€šã‚‰ãªã„
- RealVNC Viewerã§ã¯æ¥ç¶šã§ãã¦ã„ã‚‹ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ­£ã—ã„
- SSHéµèªè¨¼ã‚’è¨­å®šã—ãŸãŒæ©Ÿèƒ½ã—ãªã„
- ãƒ›ã‚¹ãƒˆå `raspberrypi` ã§æ¥ç¶šã‚’è©¦ã¿ãŸãŒã€ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ­ã‚°ã«æ¥ç¶šè©¦è¡ŒãŒè¨˜éŒ²ã•ã‚Œãªã„
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ `192.168.128.131` ã§æ¥ç¶šã™ã‚‹ã¨æˆåŠŸã™ã‚‹

**è¦å› **: 
- **ãƒ›ã‚¹ãƒˆåè§£æ±ºã®å•é¡Œ**: Macå´ã§ `raspberrypi` ã¨ã„ã†ãƒ›ã‚¹ãƒˆåãŒæ­£ã—ã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`192.168.128.131`ï¼‰ã«è§£æ±ºã•ã‚Œã¦ã„ãªã„
- Macå´ã® `/etc/hosts` ã‚„DNSè¨­å®šã« `raspberrypi` ã®ã‚¨ãƒ³ãƒˆãƒªãŒãªã„ã€ã¾ãŸã¯å¤ã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§
- SSHæ¥ç¶šæ™‚ã«ãƒ›ã‚¹ãƒˆåè§£æ±ºãŒå¤±æ•—ã—ã€åˆ¥ã®ãƒ›ã‚¹ãƒˆï¼ˆã¾ãŸã¯å­˜åœ¨ã—ãªã„ãƒ›ã‚¹ãƒˆï¼‰ã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¦ã„ãŸ
- ãã®ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ­ã‚°ã«æ¥ç¶šè©¦è¡ŒãŒè¨˜éŒ²ã•ã‚Œãšã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚‚éµèªè¨¼ã‚‚æ©Ÿèƒ½ã—ãªã‹ã£ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] SSHè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ `PasswordAuthentication yes` ã‚’ç¢ºèªãƒ»æœ‰åŠ¹åŒ– â†’ **å•é¡Œãªã—**ï¼ˆè¨­å®šã¯æ­£ã—ã„ï¼‰
- [è©¦è¡Œ2] SSHè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ `PubkeyAuthentication yes` ã‚’ç¢ºèªãƒ»æœ‰åŠ¹åŒ– â†’ **å•é¡Œãªã—**ï¼ˆè¨­å®šã¯æ­£ã—ã„ï¼‰
- [è©¦è¡Œ3] `authorized_keys` ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¬é–‹éµã‚’ç™»éŒ² â†’ **å•é¡Œãªã—**ï¼ˆéµã¯æ­£ã—ãç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ï¼‰
- [è©¦è¡Œ4] SSHã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’DEBUG3ã«ä¸Šã’ã¦è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª â†’ **æ¥ç¶šè©¦è¡ŒãŒè¨˜éŒ²ã•ã‚Œãªã„**
- [è©¦è¡Œ5] IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´æ¥æŒ‡å®šã—ã¦æ¥ç¶š â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-01ï¼‰: IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´æ¥æŒ‡å®šã—ã¦SSHæ¥ç¶šã™ã‚‹
  - `ssh denkon5sd02@192.168.128.131` ã§æ¥ç¶šæˆåŠŸ
  - ãƒ›ã‚¹ãƒˆåè§£æ±ºã®å•é¡Œã‚’å›é¿ã§ãã‚‹
  - SSHéµèªè¨¼ã‚‚æ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹

**å­¦ã‚“ã ã“ã¨**: 
- **ãƒ›ã‚¹ãƒˆåè§£æ±ºã®ç¢ºèª**: SSHæ¥ç¶šãŒå¤±æ•—ã™ã‚‹å ´åˆã€ã¾ãšãƒ›ã‚¹ãƒˆåãŒæ­£ã—ã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«è§£æ±ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹
- **IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã®æ¥ç¶š**: ãƒ›ã‚¹ãƒˆåè§£æ±ºã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã“ã¨ã§å›é¿ã§ãã‚‹
- **ãƒ­ã‚°ã®é‡è¦æ€§**: ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ­ã‚°ã«æ¥ç¶šè©¦è¡ŒãŒè¨˜éŒ²ã•ã‚Œãªã„å ´åˆã¯ã€ãƒ›ã‚¹ãƒˆåè§£æ±ºã®å•é¡Œã‚’ç–‘ã†
- **SSHè¨­å®šã®ç¢ºèª**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚„éµèªè¨¼ã®è¨­å®šãŒæ­£ã—ãã¦ã‚‚ã€æ¥ç¶šè©¦è¡Œè‡ªä½“ãŒã‚µãƒ¼ãƒãƒ¼ã«å±Šã‹ãªã„å ´åˆã¯æ©Ÿèƒ½ã—ãªã„
- **RealVNCã¨ã®é•ã„**: RealVNC Viewerã§ã¯æ¥ç¶šã§ãã¦ã‚‚ã€SSHæ¥ç¶šã§ãƒ›ã‚¹ãƒˆåè§£æ±ºãŒå¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-01ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `/etc/ssh/sshd_config`ï¼ˆRaspberry Pi 5å´ï¼‰
- `~/.ssh/authorized_keys`ï¼ˆRaspberry Pi 5å´ï¼‰
- `/etc/hosts`ï¼ˆMacå´ã€å¿…è¦ã«å¿œã˜ã¦ï¼‰

---

---

### [KB-059] ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: Phase 2.4 å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆï¼ˆ2025-12-01ï¼‰

**äº‹è±¡**: 
- ç®¡ç†ç”»é¢ã§ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„
- `GET /api/clients/alerts` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ404ã‚’è¿”ã™
- `POST /api/clients/alerts/:id/acknowledge` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ500ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
- ã‚¢ãƒ©ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯Raspberry Pi 5ã®ãƒ›ã‚¹ãƒˆå´ã«å­˜åœ¨ã™ã‚‹ãŒã€APIã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- `process.cwd()`ã§ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—ã—ã¦ã„ãŸãŒã€Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯æ­£ã—ã„ãƒ‘ã‚¹ãŒå–å¾—ã§ããªã„

**è¦å› **: 
- **Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: APIã‚³ãƒ³ãƒ†ãƒŠå†…ã§`process.cwd()`ã‚’ä½¿ç”¨ã—ã¦ã„ãŸãŒã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`/app`ï¼‰ã¨ãƒ›ã‚¹ãƒˆå´ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`/opt/RaspberryPiSystem_002/alerts`ï¼‰ãŒç•°ãªã‚‹
- **ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã®æœªè¨­å®š**: `docker-compose.server.yml`ã§`alerts/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ãªã‹ã£ãŸ
- **ç’°å¢ƒå¤‰æ•°ã®æœªè¨­å®š**: `ALERTS_DIR`ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã‹ã£ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] ã‚¢ãƒ©ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å‹•ã§ç”Ÿæˆã—ã¦ç¢ºèª â†’ **ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ã™ã‚‹ãŒAPIã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„**
- [è©¦è¡Œ2] APIã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹• â†’ **å•é¡ŒãŒè§£æ±ºã—ãªã„**
- [è©¦è¡Œ3] `process.cwd()`ã®ä»£ã‚ã‚Šã«ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ â†’ **æˆåŠŸ**
- [è©¦è¡Œ4] `docker-compose.server.yml`ã«`alerts/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã‚’è¿½åŠ  â†’ **æˆåŠŸ**
- [è©¦è¡Œ5] `ALERTS_DIR`ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š â†’ **æˆåŠŸ**

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-01ï¼‰: ä»¥ä¸‹ã®å¯¾ç­–ã‚’çµ„ã¿åˆã‚ã›ã¦è§£æ±º
  1. **ç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨**: `process.cwd()`ã®ä»£ã‚ã‚Šã«`ALERTS_DIR`ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ã‚’å–å¾—
  2. **ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã®è¿½åŠ **: `docker-compose.server.yml`ã§`alerts/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`/app/alerts`ã«ãƒã‚¦ãƒ³ãƒˆ
  3. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**: APIã‚³ãƒ³ãƒ†ãƒŠã«`ALERTS_DIR=/app/alerts`ã‚’è¨­å®š

**å­¦ã‚“ã ã“ã¨**: 
- **Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ‘ã‚¹**: ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ›ã‚¹ãƒˆå´ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ç•°ãªã‚‹ãŸã‚ã€`process.cwd()`ã¯ä¿¡é ¼ã§ããªã„
- **ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã®é‡è¦æ€§**: ãƒ›ã‚¹ãƒˆå´ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆãŒå¿…è¦
- **ç’°å¢ƒå¤‰æ•°ã®æ´»ç”¨**: ãƒ‘ã‚¹ãªã©ã®è¨­å®šå€¤ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€ç’°å¢ƒé–“ã®å·®ç•°ã«å¯¾å¿œã§ãã‚‹
- **ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ã®å¿…è¦æ€§**: ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã‚„ç’°å¢ƒå¤‰æ•°ã®å¤‰æ›´å¾Œã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®å†èµ·å‹•ãŒå¿…è¦
- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ **: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒä¸è¦ãªãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®é€šçŸ¥ã«æœ‰åŠ¹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-01ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/routes/clients.ts`ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- `infrastructure/docker/docker-compose.server.yml`ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆè¨­å®šï¼‰
- `scripts/generate-alert.sh`ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰

---

---

### [KB-070] é‹ç”¨ãƒ¢ãƒ¼ãƒ‰å¯è¦–åŒ–ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰è‡ªå‹•æ¤œå‡ºAPIï¼‰

**EXEC_PLAN.mdå‚ç…§**: Phase 1 IPã‚¢ãƒ‰ãƒ¬ã‚¹ç®¡ç†ã®å¤‰æ•°åŒ–ã¨é‹ç”¨ãƒ¢ãƒ¼ãƒ‰å¯è¦–åŒ–ï¼ˆ2025-12-04ï¼‰ã€[security-hardening-execplan.md](../plans/security-hardening-execplan.md)

**äº‹è±¡**: 
- ç¾åœ¨ã®é‹ç”¨ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼‰ãŒåˆ†ã‹ã‚‰ãªã„
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã®æœ‰ç„¡ãŒåˆ†ã‹ã‚‰ãªã„
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚ã«èª¤ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã§æ“ä½œã—ã¦ã—ã¾ã†ãƒªã‚¹ã‚¯ãŒã‚ã‚‹

**è¦å› **: 
1. **å¯è¦–åŒ–ã®ä¸è¶³**: ç¾åœ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ãŒãªã‹ã£ãŸ
2. **è‡ªå‹•æ¤œå‡ºã®ä¸è¶³**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã®æœ‰ç„¡ã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã™ã‚‹æ©Ÿèƒ½ãŒãªã‹ã£ãŸ
3. **UIè¡¨ç¤ºã®ä¸è¶³**: ç®¡ç†ç”»é¢ã§é‹ç”¨ãƒ¢ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã‹ã£ãŸ

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] ç’°å¢ƒå¤‰æ•°ã§æ‰‹å‹•è¨­å®š â†’ **å¤±æ•—**ï¼ˆè¨­å®šãƒŸã‚¹ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ï¼‰
- [è©¦è¡Œ2] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç† â†’ **å¤±æ•—**ï¼ˆå‹•çš„ãªçŠ¶æ…‹ã‚’åæ˜ ã§ããªã„ï¼‰

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-04ï¼‰:
  1. `/api/system/network-mode`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…
  2. DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆ`github.com`, `tailscale.com`, `cloudflare.com`ï¼‰ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’è‡ªå‹•æ¤œå‡º
  3. æ¥ç¶šã‚ã‚Š â†’ `{ mode: "maintenance", status: "internet_connected" }`
  4. æ¥ç¶šãªã— â†’ `{ mode: "local", status: "local_network_only" }`
  5. ç’°å¢ƒå¤‰æ•°`NETWORK_STATUS_OVERRIDE`ã§ãƒ†ã‚¹ãƒˆæ™‚ã«ä¸Šæ›¸ãå¯èƒ½ã«ã™ã‚‹
  6. ç®¡ç†ç”»é¢ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«`NetworkModeBadge`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ 
  7. React Queryã§30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
  8. ãƒãƒƒã‚¸ã‚„ã‚¢ã‚¤ã‚³ãƒ³ã§è¦–è¦šçš„ã«è¡¨ç¤ºï¼ˆãƒ­ãƒ¼ã‚«ãƒ«: ç·‘ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹: ã‚ªãƒ¬ãƒ³ã‚¸ï¼‰

**å®Ÿè£…ã®è©³ç´°**:
- APIå´ï¼ˆ`apps/api/src/routes/system/network-mode.ts`ï¼‰:
  - `dns.promises.lookup()`ã§DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ
  - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ2ç§’ã§è¤‡æ•°ã®ãƒ›ã‚¹ãƒˆã‚’è©¦è¡Œ
  - æ¥ç¶šæˆåŠŸã—ãŸãƒ›ã‚¹ãƒˆåã‚’`source`ã¨ã—ã¦è¿”ã™
  - ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’è¨ˆæ¸¬ã—ã¦è¿”ã™
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ï¼ˆ`apps/web/src/components/NetworkModeBadge.tsx`ï¼‰:
  - `useNetworkModeStatus`ãƒ•ãƒƒã‚¯ã§APIã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ30ç§’é–“éš”ï¼‰
  - æ¤œå‡ºãƒ¢ãƒ¼ãƒ‰ã¨è¨­å®šãƒ¢ãƒ¼ãƒ‰ã®ä¸ä¸€è‡´ã‚’è­¦å‘Šè¡¨ç¤º
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã¨ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã‚’è¡¨ç¤º
  - æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’è¡¨ç¤º

**å­¦ã‚“ã ã“ã¨**: 
- DNSãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯è»½é‡ã§ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã®æ¤œå‡ºã«é©ã—ã¦ã„ã‚‹
- è¤‡æ•°ã®ãƒ›ã‚¹ãƒˆã‚’è©¦è¡Œã™ã‚‹ã“ã¨ã§ã€ç‰¹å®šãƒ›ã‚¹ãƒˆã®éšœå®³ã«å½±éŸ¿ã•ã‚Œãªã„
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’çŸ­ãè¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’çŸ­ç¸®ã§ãã‚‹
- UIã§ã®å¯è¦–åŒ–ã«ã‚ˆã‚Šã€é‹ç”¨ãƒŸã‚¹ã‚’é˜²ã’ã‚‹
- ç’°å¢ƒå¤‰æ•°ã§ã®ä¸Šæ›¸ãã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-04ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/routes/system/network-mode.ts`
- `apps/api/src/routes/__tests__/network-mode.test.ts`
- `apps/api/src/config/env.ts`
- `apps/web/src/api/client.ts`
- `apps/web/src/api/hooks.ts`
- `apps/web/src/components/NetworkModeBadge.tsx`
- `apps/web/src/layouts/AdminLayout.tsx`
- `docs/security/requirements.md`
- `docs/plans/security-hardening-execplan.md`

---

---

### [KB-092] Pi4ã‚­ã‚ªã‚¹ã‚¯ã®GPUã‚¯ãƒ©ãƒƒã‚·ãƒ¥å•é¡Œ

**EXEC_PLAN.mdå‚ç…§**: å®Ÿæ©Ÿæ¤œè¨¼æº–å‚™å®Œäº†ï¼ˆ2025-12-08ï¼‰

**äº‹è±¡**: 
- Pi4ã‚­ã‚ªã‚¹ã‚¯ãŒã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹ã‚¨ãƒ©ãƒ¼ä¸­
- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒé–‹ã‘ãªã„ç’°å¢ƒï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼‰ã§ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒä¸æ˜
- ã‚­ã‚ªã‚¹ã‚¯ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€ã¾ãŸã¯é »ç¹ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹

**è¦å› **: 
- Chromiumã®GPUã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒPi4ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ç›¸æ€§ãŒæ‚ªã„
- GPUé–¢é€£ã‚¨ãƒ©ãƒ¼ï¼ˆSharedImage/GPU state invalidï¼‰ãŒé »ç™º
- ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚„GPUãƒªã‚½ãƒ¼ã‚¹ä¸è¶³ã«ã‚ˆã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥

**ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ä¾‹**:
```
ERROR:gpu/command_buffer/service/shared_image/shared_image_factory.cc:928] Could not find SharedImageBackingFactory
ERROR:gpu/ipc/service/shared_image_stub.cc:206] SharedImageStub: Unable to create shared image
ERROR:gpu/ipc/client/command_buffer_proxy_impl.cc:327] GPU state invalid after WaitForGetOffsetInRange
```

**è©¦è¡Œã—ãŸå¯¾ç­–**: 
- [è©¦è¡Œ1] ã‚­ã‚ªã‚¹ã‚¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹• â†’ **ä¸€æ™‚çš„è§£æ±º**ï¼ˆå†èµ·å‹•å¾Œã¯å‹•ä½œã™ã‚‹ãŒã€æ™‚é–“ãŒçµŒã¤ã¨å†ç™ºï¼‰
- [è©¦è¡Œ2] Pi4ã‚’å†èµ·å‹• â†’ **ç¢ºèªä¸­**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦è«‹ã«ã‚ˆã‚Šå®Ÿæ–½ï¼‰

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **ä¸€æ™‚çš„è§£æ±º**ï¼ˆ2025-12-08ï¼‰:
  1. `sudo -n systemctl restart kiosk-browser.service`ã§ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
  2. Pi4ã®å†èµ·å‹•ã§GPUãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

**æ¨å¥¨å¯¾ç­–**ï¼ˆæ¤œè¨ä¸­ï¼‰:
- **æ³¨æ„**: GPUç„¡åŠ¹åŒ–ã¯CPUè² è·ã‚’å¢—åŠ ã•ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ…é‡ã«æ¤œè¨ãŒå¿…è¦
- GPUç„¡åŠ¹åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³: Chromiumèµ·å‹•æ™‚ã«`--disable-gpu`ã‚’è¿½åŠ ï¼ˆCPUè² è·å¢—åŠ ã®ãƒªã‚¹ã‚¯ã‚ã‚Šï¼‰
- ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°: `--use-gl=swiftshader`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆCPUè² è·å¢—åŠ ã®ãƒªã‚¹ã‚¯ã‚ã‚Šï¼‰
- **ä»£æ›¿æ¡ˆ**: 
  1. GPUãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®æ›´æ–°ãƒ»å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  2. Chromiumã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´ï¼ˆã‚ˆã‚Šå®‰å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸ã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼‰
  3. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–: ä¸è¦ãªã‚¿ãƒ–ã‚„æ‹¡å¼µæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–
  4. å®šæœŸçš„ãªå†èµ·å‹•ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆcronã§è‡ªå‹•å†èµ·å‹•ï¼‰

**å­¦ã‚“ã ã“ã¨**: 
- Pi4ã®Chromiumã§GPUé–¢é€£ã‚¨ãƒ©ãƒ¼ãŒé »ç™ºã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç’°å¢ƒã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒé–‹ã‘ãªã„ãŸã‚ã€systemdãƒ­ã‚°ã§å•é¡Œã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- GPUç„¡åŠ¹åŒ–ã¯CPUè² è·ã‚’å¢—åŠ ã•ã›ã‚‹ãŸã‚ã€ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„ã®ã‚ã‚‹Pi4ã§ã¯é€†åŠ¹æœã®å¯èƒ½æ€§ãŒã‚ã‚‹
- å†èµ·å‹•ã§ä¸€æ™‚çš„ã«è§£æ±ºã™ã‚‹ãŒã€æ ¹æœ¬çš„ãªå¯¾ç­–ã¯æ…é‡ã«æ¤œè¨ãŒå¿…è¦
- GPUé–¢é€£ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› ï¼ˆãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã€Chromiumãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ï¼‰ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒé‡è¦

**è§£æ±ºçŠ¶æ³**: ğŸ”„ **ä¸€æ™‚çš„è§£æ±º**ï¼ˆ2025-12-08ã€æ ¹æœ¬å¯¾ç­–ã¯æ¤œè¨ä¸­ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `/etc/systemd/system/kiosk-browser.service`
- `scripts/client/setup-kiosk.sh`

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**ï¼ˆå„ªå…ˆé †ä½é †ï¼‰:
1. GPUãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®çŠ¶æ…‹ç¢ºèªã¨æ›´æ–°
2. Chromiumã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªã¨å®‰å®šç‰ˆã¸ã®å¤‰æ›´æ¤œè¨
3. å®šæœŸçš„ãªå†èµ·å‹•ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®šï¼ˆcronï¼‰
4. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
5. GPUç„¡åŠ¹åŒ–ã¯æœ€å¾Œã®æ‰‹æ®µã¨ã—ã¦æ¤œè¨ï¼ˆCPUè² è·å¢—åŠ ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ãŸä¸Šã§ï¼‰

---

---

### [KB-093] è¨ˆæ¸¬æ©Ÿå™¨APIã®401ã‚¨ãƒ©ãƒ¼ï¼ˆæœŸé™åˆ‡ã‚ŒJWTã¨x-client-keyã®ç«¶åˆï¼‰

**EXEC_PLAN.mdå‚ç…§**: è¨ˆæ¸¬æ©Ÿå™¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿæ©Ÿæ¤œè¨¼ï¼ˆ2025-12-10ï¼‰

**äº‹è±¡**: 
- ã‚­ã‚ªã‚¹ã‚¯ã®è¨ˆæ¸¬æ©Ÿå™¨æŒå‡ºç”»é¢ï¼ˆ`/kiosk/instruments/borrow`ï¼‰ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒç©ºã«ãªã‚‹
- APIãƒ­ã‚°ã«`AUTH_TOKEN_INVALID`ï¼ˆ401ï¼‰ã‚¨ãƒ©ãƒ¼ãŒé€£ç¶šã—ã¦è¨˜éŒ²ã•ã‚Œã‚‹
- `curl -H 'x-client-key: ...' http://localhost:8080/api/measuring-instruments`ã¯æˆåŠŸã™ã‚‹ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯å¤±æ•—

**APIã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ä¾‹**:
```json
{"level":40,"time":...,"errorCode":"AUTH_TOKEN_INVALID","errorMessage":"ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™","statusCode":401}
```

**è¦å› **: 
- ãƒ–ãƒ©ã‚¦ã‚¶ãŒæœŸé™åˆ‡ã‚Œã®JWTãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ`Authorization: Bearer eyJ...`ï¼‰ã¨`x-client-key`ã®ä¸¡æ–¹ã‚’é€ä¿¡
- APIã®`allowView`é–¢æ•°ãŒ`Authorization`ãƒ˜ãƒƒãƒ€ãƒ¼ã®å­˜åœ¨ã‚’å„ªå…ˆã—ã€JWTèªè¨¼å¤±æ•—æ™‚ã«`x-client-key`ã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ãªã„å®Ÿè£…ã ã£ãŸ

**å•é¡Œã®ã‚³ãƒ¼ãƒ‰ï¼ˆä¿®æ­£å‰ï¼‰**:
```typescript
const allowView = async (request: FastifyRequest, reply: FastifyReply) => {
  if (request.headers.authorization) {
    await canView(request, reply);  // JWTå¤±æ•—ã§ä¾‹å¤–â†’x-client-keyãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã—
    return;
  }
  await allowClientKey(request);
};
```

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-10ï¼‰: `allowView`ã¨`allowWrite`ã‚’ä¿®æ­£ã—ã€JWTèªè¨¼å¤±æ•—æ™‚ã«`x-client-key`ã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã‚ˆã†try-catchã‚’è¿½åŠ 

**ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰**:
```typescript
const allowView = async (request: FastifyRequest, reply: FastifyReply) => {
  if (request.headers.authorization) {
    try {
      await canView(request, reply);
      return;
    } catch {
      // JWTèªè¨¼å¤±æ•—æ™‚ã¯x-client-keyã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    }
  }
  await allowClientKey(request);
};
```

**å­¦ã‚“ã ã“ã¨**: 
- ãƒ–ãƒ©ã‚¦ã‚¶ã¯å¤ã„JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’`localStorage`ç­‰ã«ä¿æŒã—ç¶šã‘ã€ã‚­ã‚ªã‚¹ã‚¯ç”»é¢ã§ã‚‚é€ä¿¡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- `Authorization`ãƒ˜ãƒƒãƒ€ãƒ¼ã¨`x-client-key`ã®ä¸¡æ–¹ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®å„ªå…ˆé †ä½ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ˜ç¢ºã«è¨­è¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚­ã‚ªã‚¹ã‚¯å‘ã‘APIã¯`x-client-key`èªè¨¼ã‚’ç¢ºå®Ÿã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦æ©Ÿèƒ½ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2025-12-10ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/routes/measuring-instruments/index.ts`ï¼ˆ`allowView`, `allowWrite`é–¢æ•°ï¼‰
- `apps/api/src/lib/auth.ts`ï¼ˆ`authorizeRoles`é–¢æ•°ï¼‰

---

### [KB-130] Pi5ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ãŒç•°å¸¸ã«é«˜ã„å•é¡Œï¼ˆDocker Build Cacheã¨signage-renderedå±¥æ­´ç”»åƒã®å‰Šé™¤ï¼‰

**EXEC_PLAN.mdå‚ç…§**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†ï¼ˆ2026-01-04ï¼‰

**äº‹è±¡**: 
- Pi5ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ãŒç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§27%ï¼ˆç´„270GBï¼‰ã¨è¡¨ç¤ºã•ã‚Œã‚‹
- é–‹ç™ºæ®µéšã§1TBã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®27%ã‚’ä½¿ç”¨ã™ã‚‹ã®ã¯ç•°å¸¸ã«é«˜ã„
- `/var/lib/containerd`ãŒ224GBã¨æœ€ã‚‚å¤§ãã„
- `/opt/RaspberryPiSystem_002/storage/signage-rendered`ãŒ15GBã¨å¤§ãã„

**è¦å› **: 
1. **Docker Build Cacheã®è“„ç©**: `docker builder du`ã§ç¢ºèªã™ã‚‹ã¨237.2GBã®reclaimable build cacheãŒå­˜åœ¨
2. **signage-renderedã®å±¥æ­´ç”»åƒã®è“„ç©**: `signage_*.jpg`ãƒ•ã‚¡ã‚¤ãƒ«ãŒ13,519ä»¶ï¼ˆç´„6.2GBï¼‰è“„ç©ã•ã‚Œã¦ã„ãŸãŒã€å®Ÿéš›ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã¯`current.jpg`ã®ã¿

**èª¿æŸ»æ‰‹é †**:
1. `df -hT`ã§ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ã‚’ç¢ºèª
2. `sudo du -sh /`ã§ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚µã‚¤ã‚ºã‚’ç¢ºèª
3. `/var/lib/containerd`ã‚’è©³ç´°èª¿æŸ»ï¼ˆ`docker system df`ã§Dockerã®ä½¿ç”¨é‡ã‚’ç¢ºèªï¼‰
4. `/opt/RaspberryPiSystem_002/storage/signage-rendered`ã‚’èª¿æŸ»ï¼ˆ`find -mtime +7`ã§7æ—¥è¶…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªï¼‰
5. `apps/api/src/lib/signage-render-storage.ts`ã¨`apps/api/src/routes/signage/render.ts`ã‚’ç¢ºèªã—ã€`current.jpg`ã®ã¿ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

**æœ‰åŠ¹ã ã£ãŸå¯¾ç­–**: 
- âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2026-01-04ï¼‰:
  1. **signage-renderedã®å±¥æ­´ç”»åƒå‰Šé™¤**:
     - 7æ—¥è¶…ã®`signage_*.jpg`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`_quarantine`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«éš”é›¢
     - `current.jpg`ãŒæ­£å¸¸ã«å­˜åœ¨ã—ã€`/api/signage/current-image`ãŒHTTP 200ã‚’è¿”ã™ã“ã¨ã‚’ç¢ºèª
     - éš”é›¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ˆ6.2GBå‰Šæ¸›ã€15GBâ†’8.1GBï¼‰
  2. **Docker Build Cacheå‰Šé™¤**:
     - `docker builder prune -a --force`ã§build cacheã‚’å‰Šé™¤ï¼ˆ237.2GBâ†’0Bï¼‰
     - ç¨¼åƒã‚³ãƒ³ãƒ†ãƒŠãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆdocker-web-1, docker-api-1, docker-db-1ï¼‰

**çµæœ**:
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡: 249GBï¼ˆ27%ï¼‰â†’23GBï¼ˆ3%ï¼‰ï¼ˆç´„226GBå‰Šæ¸›ï¼‰
- containerdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: 224GBâ†’3.7GBï¼ˆç´„220GBå‰Šæ¸›ï¼‰
- signage-renderedãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: 15GBâ†’8.1GBï¼ˆç´„6.9GBå‰Šæ¸›ï¼‰
- Docker Build Cache: 237.2GBâ†’0Bï¼ˆå®Œå…¨å‰Šé™¤ï¼‰

**å­¦ã‚“ã ã“ã¨**: 
- Docker Build Cacheã¯é–‹ç™ºä¸­ã«å¤§é‡ã«è“„ç©ã•ã‚Œã‚‹ãŸã‚ã€å®šæœŸçš„ã«`docker builder prune`ã§å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- signage-renderedã®å±¥æ­´ç”»åƒã¯`current.jpg`ã®ã¿ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®šæœŸçš„ã«å‰Šé™¤ã™ã¹ã
- å‰Šé™¤å‰ã«ã¯å¿…ãšéš”é›¢â†’å‹•ä½œç¢ºèªâ†’å‰Šé™¤ã®æ‰‹é †ã‚’è¸ã‚€ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ç ´å£Šã‚’é˜²æ­¢ã§ãã‚‹
- `docker builder prune`ã¯ç¨¼åƒä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«ã¯å½±éŸ¿ã—ãªã„ï¼ˆbuild cacheã®ã¿ã‚’å‰Šé™¤ï¼‰

**è§£æ±ºçŠ¶æ³**: âœ… **è§£æ±ºæ¸ˆã¿**ï¼ˆ2026-01-04ï¼‰

**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**: 
- `apps/api/src/lib/signage-render-storage.ts`ï¼ˆsignageç”»åƒã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ï¼‰
- `apps/api/src/routes/signage/render.ts`ï¼ˆ`/current-image`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- `infrastructure/docker/docker-compose.server.yml`ï¼ˆsignage-renderedã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒã‚¦ãƒ³ãƒˆè¨­å®šï¼‰

**æ¨å¥¨å¯¾ç­–**:
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜ãƒãƒªã‚·ãƒ¼ï¼ˆ10å¹´é‹ç”¨å¯¾å¿œï¼‰**:
  1. **signage-renderedã®å±¥æ­´ç”»åƒã¯ä¿æŒã—ãªã„**: `current.jpg`ã®ã¿ãŒé‹ç”¨ä¸Šå¿…è¦ã€‚`signage_*.jpg`ã¯ç”Ÿæˆã•ã‚Œãªã„ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£æ¸ˆã¿ï¼ˆç’°å¢ƒå¤‰æ•°`SIGNAGE_RENDER_KEEP_HISTORY=1`ã§æœ‰åŠ¹åŒ–å¯èƒ½ã ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç„¡åŠ¹ï¼‰ã€‚ã‚‚ã—ç”Ÿæˆã•ã‚ŒãŸå ´åˆã¯è‡ªå‹•ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§å‰Šé™¤ã•ã‚Œã‚‹ã€‚
  2. **Docker Build Cacheã®è‡ªå‹•å‰Šé™¤**: æœˆ1å›ã€`docker builder prune -a --force`ã§build cacheã‚’å‰Šé™¤ï¼ˆsystemd timerã§è‡ªå‹•åŒ–æ¸ˆã¿ï¼‰ã€‚
  3. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã®ç›£è¦–**: ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã‚’ç›£è¦–ã—ã€70%ã§è­¦å‘Šã€80%ã§ã‚¢ãƒ©ãƒ¼ãƒˆã€90%ã§ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆï¼ˆ`monitor.sh`ã§è‡ªå‹•æ¤œçŸ¥ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆçµŒç”±ã§ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºï¼‰ã€‚
  4. **è‡ªå‹•ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: `storage-maintenance.sh`ãŒsystemd timerã§æ¯æ—¥å®Ÿè¡Œã•ã‚Œã€signageå±¥æ­´ç”»åƒã®å‰Šé™¤ã¨æœˆ1å›ã®build cacheå‰Šé™¤ã‚’è‡ªå‹•å®Ÿè¡Œã€‚å¤±æ•—æ™‚ã¯`storage-maintenance-failed`ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆã€‚

---

---
