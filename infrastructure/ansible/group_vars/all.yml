# ネットワークモードを切り替えることで、Ansibleが参照するIPアドレスを変更できます。
# - local: ローカルネットワークのIPを使用（通常運用）
# - tailscale: Tailscale経由のIPを使用（メンテナンス時）
network_mode: "local"

# ローカルネットワークで使用するIPアドレス
local_network:
  raspberrypi5_ip: "192.168.10.230"
  raspberrypi4_ip: "192.168.10.223"
  raspberrypi3_ip: "192.168.10.109"

# メンテナンス時（Tailscale経由）に使用するIPアドレス
# Tailscaleで割り当てられるIPを確認して設定してください。
tailscale_network:
  raspberrypi5_ip: "100.106.158.2"
  raspberrypi4_ip: "100.74.144.79"
  raspberrypi3_ip: "100.105.224.86"

# 現在有効なネットワーク設定（network_modeに応じて切り替え）
current_network: "{{ local_network if network_mode == 'local' else tailscale_network }}"

# サーバー（Pi5）およびクライアントのIPアドレスを共通変数として扱う
server_ip: "{{ current_network.raspberrypi5_ip | default(local_network.raspberrypi5_ip) }}"
kiosk_ip: "{{ current_network.raspberrypi4_ip | default(local_network.raspberrypi4_ip) }}"
signage_ip: "{{ current_network.raspberrypi3_ip | default(local_network.raspberrypi3_ip) }}"

# よく使うURLを共通変数として定義
server_base_url: "https://{{ server_ip }}"
kiosk_full_url: "{{ server_base_url }}/kiosk"
api_base_url: "http://{{ server_ip }}:8080/api"
websocket_agent_url: "ws://{{ server_ip }}:7071/stream"

# 既存の変数名との互換性を保つためのエイリアス
status_agent_api_base_url: "{{ api_base_url }}"
nfc_agent_api_base_url: "{{ api_base_url }}"
docker_server_ip: "{{ server_ip }}"

# Tailscale設定（デフォルトでは無効、ホスト側で上書き）
tailscale_enabled: false
tailscale_auth_key: ""
tailscale_extra_args: "--ssh"
tailscale_install_script: "https://tailscale.com/install.sh"

# セキュリティ/ファイアウォール設定
ufw_enabled: true
ufw_default_incoming_policy: "deny"
ufw_default_outgoing_policy: "allow"
ufw_allowed_tcp_ports:
  - "80"
  - "443"
ufw_ssh_allowed_networks:
  - "192.168.10.0/24"
  - "100.64.0.0/10"
# VNCポート（ローカルネットワークからのみ許可）
ufw_vnc_allowed_networks:
  - "192.168.10.0/24"
ufw_logging_level: "medium"
caddy_log_dir: "/var/log/caddy"
alert_script_path: "/opt/RaspberryPiSystem_002/scripts/generate-alert.sh"

fail2ban_enabled: true
fail2ban_defaults:
  bantime: "1h"
  findtime: "10m"
  maxretry: 5
fail2ban_http_maxretry: 15
fail2ban_http_findtime: "15m"
fail2ban_http_bantime: "1h"

# マルウェア対策設定
clamav_server_enabled: true
clamav_server_scan_paths:
  - "/opt/RaspberryPiSystem_002"
  - "/opt/backups"
clamav_server_scan_cron: "0 3 * * *"
clamav_server_log_dir: "/var/log/clamav"
clamav_server_log_file: "clamav-scan.log"
clamav_kiosk_enabled: true
clamav_kiosk_scan_paths:
  - "/opt/RaspberryPiSystem_002/storage"
clamav_kiosk_scan_cron: "0 2 * * 0"
clamav_kiosk_log_dir: "/var/log/clamav"
clamav_kiosk_log_file: "clamav-kiosk-scan.log"

trivy_enabled: true
trivy_scan_target: "/opt/RaspberryPiSystem_002"
trivy_scan_cron: "30 3 * * *"
trivy_log_dir: "/var/log/trivy"
trivy_log_file: "trivy-scan.log"
trivy_version: "0.54.1"
trivy_package_file: "trivy_{{ trivy_version }}_Linux-ARM64.deb"
trivy_download_url: "https://github.com/aquasecurity/trivy/releases/download/v{{ trivy_version }}/{{ trivy_package_file }}"
trivy_skip_dirs:
  - "/opt/RaspberryPiSystem_002/certs"
trivy_alert_ignore_patterns:
  - "/certs/"
  - "/backups/"

rkhunter_server_enabled: true
rkhunter_server_cron: "0 4 * * *"
rkhunter_log_dir: "/var/log/rkhunter"
rkhunter_log_file: "rkhunter-scan.log"
rkhunter_ignore_patterns:
  - "User 'clamav' has been added"
  - "Group 'clamav' has been added"
  - "PermitRootLogin"
  - "/dev/shm/lttng-ust-wait"
  - "/etc/.updated"

rkhunter_kiosk_enabled: true
rkhunter_kiosk_cron: "30 2 * * 0"
rkhunter_kiosk_log_dir: "/var/log/rkhunter"
rkhunter_kiosk_log_file: "rkhunter-kiosk.log"

# マルウェア対策設定
clamav:
  enabled: true
  log_dir: "/var/log/clamav"
  scan_paths:
    - "/opt/RaspberryPiSystem_002/apps/api"
    - "/opt/RaspberryPiSystem_002/apps/web"
    - "/opt/RaspberryPiSystem_002/storage"
  cron:
    minute: "0"
    hour: "3"
    weekday: "0" # Sunday

trivy:
  enabled: true
  log_dir: "/var/log/trivy"
  target_paths:
    - "/opt/RaspberryPiSystem_002"
  cron:
    minute: "0"
    hour: "4"
    weekday: "0"

rkhunter:
  enabled: true
  log_dir: "/var/log/rkhunter"
  cron:
    minute: "30"
    hour: "4"
    weekday: "0"

# 監視・アラート設定（Phase6）
security_monitor_enabled: true
security_monitor_state_dir: "/var/lib/security-monitor"
security_monitor_fail2ban_log: "/var/log/fail2ban.log"
security_monitor_timer_oncalendar: "*:0/15"
