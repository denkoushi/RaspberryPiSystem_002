# Docker Compose環境変数ファイル
# このファイルはAnsibleで管理されています
# IPアドレス変更時はこのファイルを更新してください

# サーバーIPアドレス（例: 192.168.128.131）
SERVER_IP={{ docker_server_ip | default((server_ip | default('192.168.128.131'))) }}

# その他のDocker Compose環境変数
# 必要に応じて追加してください

# API JWT秘密鍵（本番必須）
# NOTE:
# - docker-compose.server.yml の api は env_file に apps/api/.env.example と .env を読み込む。
# - .env（= infrastructure/docker/.env）にJWTが無いと、.env.exampleの弱い値へフォールバックしてAPIが起動拒否する。
# - api_jwt_*_effective は「inventoryが弱い/未設定でも、既存 apps/api/.env から復元」できるようAnsible側で解決した値。
JWT_ACCESS_SECRET={{ api_jwt_access_secret_effective | default(api_jwt_access_secret | default('')) }}
JWT_REFRESH_SECRET={{ api_jwt_refresh_secret_effective | default(api_jwt_refresh_secret | default('')) }}

# キオスクお問い合わせ（Slack通知）
# NOTE: このファイルはAnsibleで再生成されるため、手動で追記してもIP変更対応などで上書きされます。
# 永続化する場合は Ansible 側の変数（vault）で管理してください。
# 推奨: supportチャンネル（#rps-support）のIncoming Webhook URLを設定して、Generalチャンネルから分離してください
SLACK_KIOSK_SUPPORT_WEBHOOK_URL={{
  slack_kiosk_support_webhook_url
  | default(existing_slack_kiosk_support_webhook_url | default(''))
}}

# Dropbox OAuth 2.0設定
# NOTE: このファイルはAnsibleで再生成されるため、手動で追記してもIP変更対応などで上書きされます。
# 永続化する場合は Ansible 側の変数（vault）で管理してください。
DROPBOX_APP_KEY={{
  dropbox_app_key
  | default(existing_dropbox_app_key | default(''))
}}
DROPBOX_APP_SECRET={{
  dropbox_app_secret
  | default(existing_dropbox_app_secret | default(''))
}}
DROPBOX_REFRESH_TOKEN={{
  dropbox_refresh_token
  | default(existing_dropbox_refresh_token | default(''))
}}
DROPBOX_ACCESS_TOKEN={{
  dropbox_access_token
  | default(existing_dropbox_access_token | default(''))
}}

# Dropbox保存先のベースパス（Dropbox側のパス）
# 例: /backups/talkplaza
# NOTE: 未設定（空文字）の場合はAPI側のデフォルト/設定ファイルに従う
DROPBOX_BASE_PATH={{
  dropbox_base_path
  | default(existing_dropbox_base_path | default(''))
}}

# Alerts Platform Phase2設定
# NOTE: このファイルはAnsibleで再生成されるため、手動で追記してもIP変更対応などで上書きされます。
# 永続化する場合は Ansible 側の変数（group_vars/host_vars/vault）で管理してください。
# Phase2完全移行: DB中心運用（mode=db）
ALERTS_DISPATCHER_MODE={{
  alerts_dispatcher_mode
  | default(existing_alerts_dispatcher_mode | default('db'))
}}
ALERTS_DB_DISPATCHER_ENABLED={{
  alerts_db_dispatcher_enabled
  | default(existing_alerts_db_dispatcher_enabled | default('true'))
}}
ALERTS_DB_INGEST_ENABLED={{
  alerts_db_ingest_enabled
  | default(existing_alerts_db_ingest_enabled | default('true'))
}}

# Alerts Dispatcher設定（Slack通知ルーティング）
# NOTE: このファイルはAnsibleで再生成されるため、手動で追記してもIP変更対応などで上書きされます。
# 永続化する場合は Ansible 側の変数（vault）で管理してください。
# Alerts Dispatcherを有効化（trueで有効化、falseで無効化）
ALERTS_DISPATCHER_ENABLED={{
  alerts_dispatcher_enabled
  | default(existing_alerts_dispatcher_enabled | default('true'))
}}
# Slack Webhook URLs (route-based)
# 未設定（空文字）の場合は、そのrouteKeyのアラートはSlackに送信されません（ファイル生成のみ）
ALERTS_SLACK_WEBHOOK_DEPLOY={{
  alerts_slack_webhook_deploy
  | default(existing_alerts_slack_webhook_deploy | default(''))
}}
ALERTS_SLACK_WEBHOOK_OPS={{
  alerts_slack_webhook_ops
  | default(existing_alerts_slack_webhook_ops | default(''))
}}
ALERTS_SLACK_WEBHOOK_SECURITY={{
  alerts_slack_webhook_security
  | default(existing_alerts_slack_webhook_security | default(''))
}}
ALERTS_SLACK_WEBHOOK_SUPPORT={{
  alerts_slack_webhook_support
  | default(existing_alerts_slack_webhook_support | default(''))
}}